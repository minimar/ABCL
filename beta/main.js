!function(e){"use strict";const t=new class{constructor(){this.logs=[],this.maxLogSize=100}log(e,t,n){const o={message:t,level:e,version:"2.0.0",timestamp:(new Date).toISOString()};n("%cABCL:","font-weight: bold; color: #f6cbde;",o),this.logs.push(o),this.logs.length>this.maxLogSize&&this.logs.shift()}info(e){this.log("INFO",e,console.log)}debug(e){this.log("DEBUG",e,console.debug)}warn(e){this.log("WARN",e,console.warn)}error(e){this.log("ERROR",e,console.error)}getLogs(){return this.logs}};var n={};!function(e){!function(){const t="1.2.0";function n(e){alert("Mod ERROR:\n"+e);const t=new Error(e);throw console.error(t),t}const o=new TextEncoder;function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function s(e){const t=new Set;return e.filter((e=>!t.has(e)&&t.add(e)))}const r=new Map,a=new Set;function l(e){a.has(e)||(a.add(e),console.warn(e))}function c(e){const t=[],n=new Map,o=new Set;for(const i of h.values()){const s=i.patching.get(e.name);if(s){t.push(...s.hooks);for(const[t,r]of s.patches.entries())n.has(t)&&n.get(t)!==r&&l(`ModSDK: Mod '${i.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${t}\nPatch1:\n${n.get(t)||""}\nPatch2:\n${r}`),n.set(t,r),o.add(i.name)}}t.sort(((e,t)=>t.priority-e.priority));const i=function(e,t){if(0===t.size)return e;let n=e.toString().replaceAll("\r\n","\n");for(const[o,i]of t.entries())n.includes(o)||l(`ModSDK: Patching ${e.name}: Patch ${o} not applied`),n=n.replaceAll(o,i);return(0,eval)(`(${n})`)}(e.original,n);let s=function(t){var n,s;const r=null===(s=(n=y.errorReporterHooks).hookChainExit)||void 0===s?void 0:s.call(n,e.name,o),a=i.apply(this,t);return null==r||r(),a};for(let n=t.length-1;n>=0;n--){const o=t[n],i=s;s=function(t){var n,s;const r=null===(s=(n=y.errorReporterHooks).hookEnter)||void 0===s?void 0:s.call(n,e.name,o.mod),a=o.hook.apply(this,[t,e=>{if(1!==arguments.length||!Array.isArray(t))throw new Error(`Mod ${o.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return i.call(this,e)}]);return null==r||r(),a}}return{hooks:t,patches:n,patchesSources:o,enter:s,final:i}}function d(e,t=!1){let n=r.get(e);if(n)t&&(n.precomputed=c(n));else{let t=window;const s=e.split(".");for(let n=0;n<s.length-1;n++)if(t=t[s[n]],!i(t))throw new Error(`ModSDK: Function ${e} to be patched not found; ${s.slice(0,n+1).join(".")} is not object`);const a=t[s[s.length-1]];if("function"!=typeof a)throw new Error(`ModSDK: Function ${e} to be patched not found`);const l=function(e){let t=-1;for(const n of o.encode(e)){let e=255&(t^n);for(let t=0;t<8;t++)e=1&e?-306674912^e>>>1:e>>>1;t=t>>>8^e}return(~t>>>0).toString(16).padStart(8,"0").toUpperCase()}(a.toString().replaceAll("\r\n","\n")),d={name:e,original:a,originalHash:l};n=Object.assign(Object.assign({},d),{precomputed:c(d),router:()=>{},context:t,contextProperty:s[s.length-1]}),n.router=function(e){return function(...t){return e.precomputed.enter.apply(this,[t])}}(n),r.set(e,n),t[n.contextProperty]=n.router}return n}function u(){for(const e of r.values())e.precomputed=c(e)}function p(){const e=new Map;for(const[t,n]of r)e.set(t,{name:t,original:n.original,originalHash:n.originalHash,sdkEntrypoint:n.router,currentEntrypoint:n.context[n.contextProperty],hookedByMods:s(n.precomputed.hooks.map((e=>e.mod))),patchedByMods:Array.from(n.precomputed.patchesSources)});return e}const h=new Map;function m(e){h.get(e.name)!==e&&n(`Failed to unload mod '${e.name}': Not registered`),h.delete(e.name),e.loaded=!1,u()}function g(e,t){e&&"object"==typeof e||n("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||n("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let o=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||n(`Failed to register mod ${o}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),o=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&n(`Failed to register mod ${o}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&n(`Failed to register mod ${o}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||n(`Failed to register mod ${o}: Expected options to be undefined or object, got ${typeof t}`);const s=!0===t.allowReplace,r=h.get(e.name);r&&(r.allowReplace&&s||n(`Refusing to load mod ${o}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),m(r));const a=e=>{let t=p.patching.get(e.name);return t||(t={hooks:[],patches:new Map},p.patching.set(e.name,t)),t},l=(e,t)=>(...i)=>{var s,r;const a=null===(r=(s=y.errorReporterHooks).apiEndpointEnter)||void 0===r?void 0:r.call(s,e,p.name);p.loaded||n(`Mod ${o} attempted to call SDK function after being unloaded`);const l=t(...i);return null==a||a(),l},c={unload:l("unload",(()=>m(p))),hookFunction:l("hookFunction",((e,t,i)=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const s=d(e),r=a(s);"number"!=typeof t&&n(`Mod ${o} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof i&&n(`Mod ${o} failed to hook function '${e}': Expected hook function, got ${typeof i}`);const l={mod:p.name,priority:t,hook:i};return r.hooks.push(l),u(),()=>{const e=r.hooks.indexOf(l);e>=0&&(r.hooks.splice(e,1),u())}})),patchFunction:l("patchFunction",((e,t)=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const s=d(e),r=a(s);i(t)||n(`Mod ${o} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[i,s]of Object.entries(t))"string"==typeof s?r.patches.set(i,s):null===s?r.patches.delete(i):n(`Mod ${o} failed to patch function '${e}': Invalid format of patch '${i}'`);u()})),removePatches:l("removePatches",(e=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const t=d(e);a(t).patches.clear(),u()})),callOriginal:l("callOriginal",((e,t,i)=>{"string"==typeof e&&e||n(`Mod ${o} failed to call a function: Expected function name string, got ${typeof e}`);const s=d(e);return Array.isArray(t)||n(`Mod ${o} failed to call a function: Expected args array, got ${typeof t}`),s.original.apply(null!=i?i:globalThis,t)})),getOriginalHash:l("getOriginalHash",(e=>("string"==typeof e&&e||n(`Mod ${o} failed to get hash: Expected function name string, got ${typeof e}`),d(e).originalHash)))},p={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:s,api:c,loaded:!0,patching:new Map};return h.set(e.name,p),Object.freeze(c)}function f(){const e=[];for(const t of h.values())e.push({name:t.name,fullName:t.fullName,version:t.version,repository:t.repository});return e}let y;const b=void 0===window.bcModSdk?window.bcModSdk=function(){const e={version:t,apiVersion:1,registerMod:g,getModsInfo:f,getPatchingInfo:p,errorReporterHooks:Object.seal({apiEndpointEnter:null,hookEnter:null,hookChainExit:null})};return y=e,Object.freeze(e)}():(i(window.bcModSdk)||n("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&n(`Failed to init Mod SDK: Different version already loaded ('1.2.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==t&&alert(`Mod SDK warning: Loading different but compatible versions ('1.2.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk);Object.defineProperty(e,"__esModule",{value:!0}),e.default=b}()}(n);var o,i=(o=n)&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;const s="ABCL";var r;!function(e){e[e.Anyone=0]="Anyone",e[e.ItemPermission=1]="ItemPermission",e[e.Friends=2]="Friends",e[e.Lovers=3]="Lovers",e[e.Owner=5]="Owner",e[e.Self=6]="Self"}(r||(r={}));var a="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,c=a||l||Function("return this")(),d=c.Symbol,u=Object.prototype,p=u.hasOwnProperty,h=u.toString,m=d?d.toStringTag:void 0;var g=Object.prototype.toString;var f="[object Null]",y="[object Undefined]",b=d?d.toStringTag:void 0;function v(e){return null==e?void 0===e?y:f:b&&b in Object(e)?function(e){var t=p.call(e,m),n=e[m];try{e[m]=void 0;var o=!0}catch(e){}var i=h.call(e);return o&&(t?e[m]=n:delete e[m]),i}(e):function(e){return g.call(e)}(e)}function w(e){return null!=e&&"object"==typeof e}var C=Array.isArray;function S(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function B(e){return e}var A="[object AsyncFunction]",M="[object Function]",L="[object GeneratorFunction]",x="[object Proxy]";function P(e){if(!S(e))return!1;var t=v(e);return t==M||t==L||t==A||t==x}var D,k=c["__core-js_shared__"],I=(D=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+D:"";var _=Function.prototype.toString;var F=/^\[object .+?Constructor\]$/,T=Function.prototype,E=Object.prototype,$=T.toString,z=E.hasOwnProperty,O=RegExp("^"+$.call(z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function j(e){return!(!S(e)||(t=e,I&&I in t))&&(P(e)?O:F).test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function W(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return j(n)?n:void 0}var R=Object.create,N=function(){function e(){}return function(t){if(!S(t))return{};if(R)return R(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var V=Date.now;var G,H,Y,U=function(){try{var e=W(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),X=U?function(e,t){return U(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:B,q=(G=X,H=0,Y=0,function(){var e=V(),t=16-(e-Y);if(Y=e,t>0){if(++H>=800)return arguments[0]}else H=0;return G.apply(void 0,arguments)}),K=9007199254740991,J=/^(?:0|[1-9]\d*)$/;function Z(e,t){var n=typeof e;return!!(t=null==t?K:t)&&("number"==n||"symbol"!=n&&J.test(e))&&e>-1&&e%1==0&&e<t}function Q(e,t,n){"__proto__"==t&&U?U(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ee(e,t){return e===t||e!=e&&t!=t}var te=Object.prototype.hasOwnProperty;function ne(e,t,n){var o=e[t];te.call(e,t)&&ee(o,n)&&(void 0!==n||t in e)||Q(e,t,n)}var oe=Math.max;function ie(e,t){return q(function(e,t,n){return t=oe(void 0===t?e.length-1:t,0),function(){for(var o=arguments,i=-1,s=oe(o.length-t,0),r=Array(s);++i<s;)r[i]=o[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=o[i];return a[t]=n(r),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}(e,t,B),e+"")}var se=9007199254740991;function re(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=se}function ae(e){return null!=e&&re(e.length)&&!P(e)}var le=Object.prototype;function ce(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||le)}function de(e){return w(e)&&"[object Arguments]"==v(e)}var ue=Object.prototype,pe=ue.hasOwnProperty,he=ue.propertyIsEnumerable,me=de(function(){return arguments}())?de:function(e){return w(e)&&pe.call(e,"callee")&&!he.call(e,"callee")},ge=me;var fe="object"==typeof e&&e&&!e.nodeType&&e,ye=fe&&"object"==typeof module&&module&&!module.nodeType&&module,be=ye&&ye.exports===fe?c.Buffer:void 0,ve=(be?be.isBuffer:void 0)||function(){return!1},we={};we["[object Float32Array]"]=we["[object Float64Array]"]=we["[object Int8Array]"]=we["[object Int16Array]"]=we["[object Int32Array]"]=we["[object Uint8Array]"]=we["[object Uint8ClampedArray]"]=we["[object Uint16Array]"]=we["[object Uint32Array]"]=!0,we["[object Arguments]"]=we["[object Array]"]=we["[object ArrayBuffer]"]=we["[object Boolean]"]=we["[object DataView]"]=we["[object Date]"]=we["[object Error]"]=we["[object Function]"]=we["[object Map]"]=we["[object Number]"]=we["[object Object]"]=we["[object RegExp]"]=we["[object Set]"]=we["[object String]"]=we["[object WeakMap]"]=!1;var Ce="object"==typeof e&&e&&!e.nodeType&&e,Se=Ce&&"object"==typeof module&&module&&!module.nodeType&&module,Be=Se&&Se.exports===Ce&&a.process,Ae=function(){try{var e=Se&&Se.require&&Se.require("util").types;return e||Be&&Be.binding&&Be.binding("util")}catch(e){}}(),Me=Ae&&Ae.isTypedArray,Le=Me?function(e){return function(t){return e(t)}}(Me):function(e){return w(e)&&re(e.length)&&!!we[v(e)]},xe=Object.prototype.hasOwnProperty;function Pe(e,t){var n=C(e),o=!n&&ge(e),i=!n&&!o&&ve(e),s=!n&&!o&&!i&&Le(e),r=n||o||i||s,a=r?function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}(e.length,String):[],l=a.length;for(var c in e)!t&&!xe.call(e,c)||r&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Z(c,l))||a.push(c);return a}var De=Object.prototype.hasOwnProperty;function ke(e){if(!S(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=ce(e),n=[];for(var o in e)("constructor"!=o||!t&&De.call(e,o))&&n.push(o);return n}function Ie(e){return ae(e)?Pe(e,!0):ke(e)}var _e=W(Object,"create");var Fe=Object.prototype.hasOwnProperty;var Te=Object.prototype.hasOwnProperty;function Ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function $e(e,t){for(var n=e.length;n--;)if(ee(e[n][0],t))return n;return-1}Ee.prototype.clear=function(){this.__data__=_e?_e(null):{},this.size=0},Ee.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ee.prototype.get=function(e){var t=this.__data__;if(_e){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Fe.call(t,e)?t[e]:void 0},Ee.prototype.has=function(e){var t=this.__data__;return _e?void 0!==t[e]:Te.call(t,e)},Ee.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=_e&&void 0===t?"__lodash_hash_undefined__":t,this};var ze=Array.prototype.splice;function Oe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Oe.prototype.clear=function(){this.__data__=[],this.size=0},Oe.prototype.delete=function(e){var t=this.__data__,n=$e(t,e);return!(n<0)&&(n==t.length-1?t.pop():ze.call(t,n,1),--this.size,!0)},Oe.prototype.get=function(e){var t=this.__data__,n=$e(t,e);return n<0?void 0:t[n][1]},Oe.prototype.has=function(e){return $e(this.__data__,e)>-1},Oe.prototype.set=function(e,t){var n=this.__data__,o=$e(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this};var je=W(c,"Map");function We(e,t){var n,o,i=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Re(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Re.prototype.clear=function(){this.size=0,this.__data__={hash:new Ee,map:new(je||Oe),string:new Ee}},Re.prototype.delete=function(e){var t=We(this,e).delete(e);return this.size-=t?1:0,t},Re.prototype.get=function(e){return We(this,e).get(e)},Re.prototype.has=function(e){return We(this,e).has(e)},Re.prototype.set=function(e,t){var n=We(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};var Ne=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object),Ve="[object Object]",Ge=Function.prototype,He=Object.prototype,Ye=Ge.toString,Ue=He.hasOwnProperty,Xe=Ye.call(Object);function qe(e){var t=this.__data__=new Oe(e);this.size=t.size}qe.prototype.clear=function(){this.__data__=new Oe,this.size=0},qe.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},qe.prototype.get=function(e){return this.__data__.get(e)},qe.prototype.has=function(e){return this.__data__.has(e)},qe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Oe){var o=n.__data__;if(!je||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new Re(o)}return n.set(e,t),this.size=n.size,this};var Ke="object"==typeof e&&e&&!e.nodeType&&e,Je=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Ze=Je&&Je.exports===Ke?c.Buffer:void 0,Qe=Ze?Ze.allocUnsafe:void 0;var et=c.Uint8Array;function tt(e,t){var n,o,i=t?(n=e.buffer,o=new n.constructor(n.byteLength),new et(o).set(new et(n)),o):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var nt,ot=function(e,t,n){for(var o=-1,i=Object(e),s=n(e),r=s.length;r--;){var a=s[nt?r:++o];if(!1===t(i[a],a,i))break}return e};function it(e,t,n){(void 0!==n&&!ee(e[t],n)||void 0===n&&!(t in e))&&Q(e,t,n)}function st(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function rt(e){return function(e,t,n,o){var i=!n;n||(n={});for(var s=-1,r=t.length;++s<r;){var a=t[s],l=o?o(n[a],e[a],a,n,e):void 0;void 0===l&&(l=e[a]),i?Q(n,a,l):ne(n,a,l)}return n}(e,Ie(e))}function at(e,t,n,o,i,s,r){var a=st(e,n),l=st(t,n),c=r.get(l);if(c)it(e,n,c);else{var d,u=s?s(a,l,n+"",e,t,r):void 0,p=void 0===u;if(p){var h=C(l),m=!h&&ve(l),g=!h&&!m&&Le(l);u=l,h||m||g?C(a)?u=a:w(d=a)&&ae(d)?u=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t}(a):m?(p=!1,u=function(e,t){if(t)return e.slice();var n=e.length,o=Qe?Qe(n):new e.constructor(n);return e.copy(o),o}(l,!0)):g?(p=!1,u=tt(l,!0)):u=[]:function(e){if(!w(e)||v(e)!=Ve)return!1;var t=Ne(e);if(null===t)return!0;var n=Ue.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ye.call(n)==Xe}(l)||ge(l)?(u=a,ge(a)?u=rt(a):S(a)&&!P(a)||(u=function(e){return"function"!=typeof e.constructor||ce(e)?{}:N(Ne(e))}(l))):p=!1}p&&(r.set(l,u),i(u,l,o,s,r),r.delete(l)),it(e,n,u)}}function lt(e,t,n,o,i){e!==t&&ot(t,(function(s,r){if(i||(i=new qe),S(s))at(e,t,r,n,lt,o,i);else{var a=o?o(st(e,r),s,r+"",e,t,i):void 0;void 0===a&&(a=s),it(e,r,a)}}),Ie)}var ct,dt=(ct=function(e,t,n){lt(e,t,n)},ie((function(e,t){var n=-1,o=t.length,i=o>1?t[o-1]:void 0,s=o>2?t[2]:void 0;for(i=ct.length>3&&"function"==typeof i?(o--,i):void 0,s&&function(e,t,n){if(!S(n))return!1;var o=typeof t;return!!("number"==o?ae(n)&&Z(t,n.length):"string"==o&&t in n)&&ee(n[t],e)}(t[0],t[1],s)&&(i=o<3?void 0:i,o=1),e=Object(e);++n<o;){var r=t[n];r&&ct(e,r,n,i)}return e})));const ut={Metabolism:{value:"Normal",permission:{canView:r.Anyone,canModify:r.Owner}},DisableWetting:{value:!1,permission:{canView:r.Owner,canModify:r.Self}},DisableSoiling:{value:!1,permission:{canView:r.Owner,canModify:r.Self}},CaregiverIDs:{value:[],permission:{canView:r.Anyone,canModify:r.Self}},OpenRemoteSettings:{value:!1,permission:{canView:r.Anyone,canModify:r.Self}},LockedOutOfSettings:{value:!1,permission:{canView:r.Owner,canModify:r.Self}}},pt={Bladder:{value:0,size:300},Bowel:{value:0,size:200},Soiliness:{value:0},Wetness:{value:0},WaterIntake:{value:15},FoodIntake:{value:200/60},Incontinence:{value:0},MentalRegression:{value:0}},ht={Settings:ut,Stats:pt};let mt=null;const gt=()=>{const e=LZString.compressToBase64(JSON.stringify(Player.ABCL));Player.ExtensionSettings.ABCL=e,mt&&(t.debug("Clearing existing data save timeout"),clearTimeout(mt)),mt=setTimeout((()=>{ServerPlayerExtensionSettingsSync("ABCL"),t.debug({message:"Data saved, sending update to server",data:e}),Jt()}),1e3)},ft=i.registerMod({name:s,fullName:s,version:"2.0.0",repository:"https://github.com/zoe-64/ABCL"});function yt(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}const bt=e=>{if(!ServerPlayerIsInChatRoom())return;const t=document.createElement("div");t.innerHTML=e.split("\n").map((e=>e.trim())).join("<br/>"),t.classList.add("ABCLLocalMessage"),document.querySelector("#TextAreaChatLog")?.appendChild(t),ElementScrollToEnd("TextAreaChatLog")};const vt=e=>`${e=e||"ABCL"}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const wt=new Map;class Ct{constructor(e,t,n=1e4){this.requestTime=Date.now(),this.target=e,this.state="pending",this.type=t,this.id=vt(t),this.timeout=n,wt.set(this.id,this),setTimeout((()=>{"pending"===this.state&&(this.state="timedout",this.sync())}),n),this.sync()}sync(){const e={Type:"Hidden",Content:"ABCLMsg",Sender:Player.MemberNumber,Target:this.target,Dictionary:[{message:{type:this.type,state:this.state,id:this.id}}]};ServerSend("ChatRoomChat",e)}cancel(){this.state="cancelled",this.sync()}}class St{constructor(){this.folded=!1,document.addEventListener("click",(()=>{"ChatRoom"!==CurrentScreen?(this.close(),this.openButton.style.display="none"):this.openButton.style.display="block"})),this.openButton=document.createElement("button"),this.openButton.classList.add("ABCLOpenStatsButton"),this.openButton.textContent="ABCL Stats",Mt.appendChild(this.openButton),this.statsWindow=document.createElement("div"),new Bt(this.statsWindow),this.statsWindow.classList.add("ABCLStatsWindow"),this.statsWindow.innerHTML=`\n    <div class="ABCLWindowHeader">\n    <p class="ABCLWindowHeaderTitle">Stats</p>\n    <button class="ABCLWindowMinimize">△</button>\n    <button class="ABCLWindowClose">X</button>\n    </div>\n\t\t<div class="ABCLStatsWindowContent">\n\t\t\t<ol class="ABCLStatsWindowList">  \n      ${this.getStatsListElement("SoilinessPercentage","Soiled-ness")}\n      ${this.getStatsListElement("WetnessPercentage","Wetness")} \n      ${this.getStatsListElement("BowelFullness","Bowel")}\n      ${this.getStatsListElement("BladderFullness","Bladder")}\n      ${this.getStatsListElement("Incontinence","Incontinence")}\n      ${this.getStatsListElement("MentalRegression","Mental Regression")}\n      </ol>\n\t\t</div>\n\t`,this.minimizeButton=this.statsWindow.querySelector(".ABCLWindowMinimize"),this.closeButton=this.statsWindow.querySelector(".ABCLWindowClose"),this.minimizeButton.addEventListener("click",(()=>this.fold())),Mt.appendChild(this.statsWindow),this.openButton.addEventListener("click",(()=>{this.statsWindow.classList.contains("ABCLHidden")?this.open():this.close()})),this.closeButton.addEventListener("click",(()=>this.close())),this.update()}close(){this.statsWindow.classList.add("ABCLHidden")}open(){this.statsWindow.classList.remove("ABCLHidden"),this.statsWindow.style.top="0px",this.statsWindow.style.left="0px"}fold(){this.statsWindow.classList.toggle("ABCLStatsWindowFolded"),this.minimizeButton.textContent=this.folded?"△":"▽",this.folded=!this.folded}getStatsListElement(e,t){return`\n\t\t\t\t<li class="ABCLStatsWindowListItem ABCL${e}"> ${t}\n        <p></p>\n        <input type="range" min="0" max="100" class="ABCLStatsWindowSlider ABCL${e}Slider" readonly>\n        </li>\n      `}async update(){const e=(e,t)=>{this.statsWindow.querySelector(`.ABCL${e} input`)?.setAttribute("value",""+100*t);const n=this.statsWindow.querySelector(`.ABCL${e} p`);n&&(n.textContent=Math.floor(1e3*t)/10+"%")};e("SoilinessPercentage",Pt.stats.SoilinessPercentage),e("WetnessPercentage",Pt.stats.WetnessPercentage),e("BowelFullness",Pt.stats.BowelFullness),e("BladderFullness",Pt.stats.BladderFullness),e("Incontinence",Pt.stats.Incontinence),e("MentalRegression",Pt.stats.MentalRegression)}}class Bt{constructor(e,t=!1){this.newX=0,this.newY=0,this.oldX=0,this.oldY=0,this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,this.edgeThreshold=10,this.resizable=!0,this.element=e,this.resizable=t,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onMouseMoveForCursor=this.onMouseMoveForCursor.bind(this),this.element.addEventListener("mousedown",this.onMouseDown),this.element.addEventListener("mousemove",this.onMouseMoveForCursor),this.element.style.position="fixed",this.resizable&&(this.element.style.resize="none",this.element.addEventListener("mouseenter",this.onMouseEnter),this.element.addEventListener("mouseleave",this.onMouseLeave))}onMouseEnter(e){this.element.addEventListener("mousemove",this.onMouseMoveForCursor)}onMouseLeave(e){this.element.removeEventListener("mousemove",this.onMouseMoveForCursor),this.element.style.cursor="default"}onMouseMoveForCursor(e){const{offsetX:t,offsetY:n}=e,{offsetWidth:o,offsetHeight:i}=this.element;this.resizable&&(t<this.edgeThreshold||t>o-this.edgeThreshold?this.element.style.cursor="ew-resize":n<this.edgeThreshold||n>i-this.edgeThreshold?this.element.style.cursor="ns-resize":this.element.style.cursor="default")}onMouseDown(e){const{offsetX:t,offsetY:n}=e,{offsetWidth:o,offsetHeight:i}=this.element;this.resizable?t<this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="left"):t>o-this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="right"):n<this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="top"):n>i-this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="bottom"):this.isDragging=!0:this.isDragging=!0,(this.isDragging||this.isResizing)&&(e.preventDefault(),this.oldX=e.clientX,this.oldY=e.clientY,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}onMouseMove(e){if(this.isDragging)this.newX=this.oldX-e.clientX,this.newY=this.oldY-e.clientY,this.oldX=e.clientX,this.oldY=e.clientY,this.element.style.top=this.element.offsetTop-this.newY+"px",this.element.style.left=this.element.offsetLeft-this.newX+"px";else if(this.isResizing){const t=e.clientX-this.oldX,n=e.clientY-this.oldY,o=getComputedStyle(this.element),i=parseInt(o.left,10),s=parseInt(o.top,10),r=parseInt(o.width,10),a=parseInt(o.height,10);switch(this.resizeDirection){case"left":this.element.style.width=r-t+"px",this.element.style.left=`${i+t/2}px`;break;case"right":this.element.style.width=`${r+t}px`,this.element.style.left=`${i+t/2}px`;break;case"top":this.element.style.height=a-n+"px",this.element.style.top=`${s+n/2}px`;break;case"bottom":this.element.style.height=`${a+n}px`,this.element.style.top=`${s+n/2}px`}this.oldX=e.clientX,this.oldY=e.clientY}}onMouseUp(e){e.preventDefault(),this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}}class At{constructor(e,t,n,o=-1){this.prompt=document.createElement("div"),new Bt(this.prompt),this.id=vt(),this.message=e,this.onAccept=t,this.onDeny=n,this.show(),-1!==o&&setTimeout((()=>{this.prompt.remove()}),o)}show(){this.prompt.classList.add("ABCLPrompt"),this.prompt.id=this.id,this.prompt.innerHTML=`<p>${this.message}</p><button class="ABCLPromptNo ABCLButton">Deny</button><button class="ABCLPromptYes ABCLButton">Accept</button>`,Mt.appendChild(this.prompt),this.prompt.querySelector(`#${this.id} .ABCLPromptYes`)?.addEventListener("click",(()=>{this.onAccept(),this.prompt.remove()})),this.prompt.querySelector(`#${this.id} .ABCLPromptNo`)?.addEventListener("click",(()=>{this.onDeny(),this.prompt.remove()}))}}const Mt=document.createElement("div");let Lt;Mt.classList.add("ABCLOverlay");const xt=new Map([["Slow",.5],["Normal",1],["Fast",1.5],["Faster",2],["Fastest",3]]),Pt={onAccident:()=>{Pt.stats.MentalRegression+=Ht()},update:()=>{Pt.stats.MentalRegression+=Vt(),Pt.stats.BladderValue+=Pt.stats.WaterIntake*Pt.settings.MetabolismValue,Pt.stats.BowelValue+=Pt.stats.FoodIntake*Pt.settings.MetabolismValue,Pt.attemptWetting(),Pt.attemptSoiling(),Dt.save()},attemptWetting:()=>{if(!Pt.settings.DisableWetting&&(kt.check()&&Rt(Pt.stats.Incontinence,Pt.stats.BladderFullness)>Math.random()||Pt.stats.BladderFullness>=Rt(Pt.stats.Incontinence,1))){if("ChatRoom"!=CurrentScreen)return void window.WetMinigameEnd(!1);MiniGameStart("WetMinigame",20*Rt(Pt.stats.Incontinence,Pt.stats.BladderFullness),"noOp")}},attemptSoiling:()=>{if(!Pt.settings.DisableSoiling&&(kt.check()&&Rt(Pt.stats.Incontinence,Pt.stats.BowelFullness)>Math.random()||Pt.stats.BowelFullness>=Rt(Pt.stats.Incontinence,1))){if("ChatRoom"!=CurrentScreen)return void window.MessMinigameEnd(!1);MiniGameStart("MessMinigame",20*Rt(Pt.stats.Incontinence,Pt.stats.BowelFullness),"noOp")}},releaseBladder:()=>{const e=Pt.stats.BladderFullness<.3,t=!e,n=Pt.stats.BladderFullness>.6;e?bt("You try to pee, but it doesn't seem to be working."):(t&&(Pt.stats.WetnessValue+=Pt.stats.BladderValue,Pt.stats.BladderFullness=0,bt("You feel a sense of release as you let go.")),n?Pt.stats.Incontinence-=.02:Pt.stats.Incontinence+=.02)},releaseBowel:()=>{const e=Pt.stats.BowelFullness<.3,t=!e,n=Pt.stats.BowelFullness>.6;e?bt("You try to let go, but nothing seems to happen."):(t&&(Pt.stats.SoilinessValue+=Pt.stats.BowelValue,Pt.stats.BowelFullness=0,bt("You feel a little relief as you let go.")),n?Pt.stats.Incontinence-=.02:Pt.stats.Incontinence+=.02)},stats:{set MentalRegression(e){e<0&&(e=0),e>1&&(e=1),Player.ABCL.Stats.MentalRegression.value=e,Lt.update()},get MentalRegression(){return Player.ABCL.Stats.MentalRegression.value},set Incontinence(e){e<0&&(e=0),e>1&&(e=1),Player.ABCL.Stats.Incontinence.value=e,Lt.update()},get Incontinence(){return Player.ABCL.Stats.Incontinence.value},set WaterIntake(e){e<0&&(e=0),Player.ABCL.Stats.WaterIntake.value=e},get WaterIntake(){return Player.ABCL.Stats.WaterIntake.value},set FoodIntake(e){e<0&&(e=0),Player.ABCL.Stats.FoodIntake.value=e},get FoodIntake(){return Player.ABCL.Stats.FoodIntake.value},set BladderValue(e){Pt.settings.DisableWetting||(e<0&&(e=0),Player.ABCL.Stats.Bladder.value=e,Lt.update())},get BladderValue(){return Player.ABCL.Stats.Bladder.value},set BladderSize(e){e<0&&(e=0),Player.ABCL.Stats.Bladder.size=e,Lt.update()},get BladderSize(){return Player.ABCL.Stats.Bladder.size},set WetnessValue(e){e<0&&(e=0),Player.ABCL.Stats.Wetness.value=e,Ot(),Lt.update()},get WetnessValue(){return Player.ABCL.Stats.Wetness.value},set BladderFullness(e){e<0&&(e=0),this.BladderValue=e*this.BladderSize,Lt.update()},get BladderFullness(){return this.BladderValue/this.BladderSize},set BowelValue(e){Pt.settings.DisableSoiling||(e<0&&(e=0),Player.ABCL.Stats.Bowel.value=e,Lt.update())},get BowelValue(){return Player.ABCL.Stats.Bowel.value},set BowelSize(e){e<0&&(e=0),Player.ABCL.Stats.Bowel.size=e,Lt.update()},get BowelSize(){return Player.ABCL.Stats.Bowel.size},set SoilinessValue(e){e<0&&(e=0),Player.ABCL.Stats.Soiliness.value=e,Ot(),Lt.update()},get SoilinessValue(){return Player.ABCL.Stats.Soiliness.value},set BowelFullness(e){e<0&&(e=0),this.BowelValue=e*this.BowelSize,Lt.update()},get BowelFullness(){return this.BowelValue/this.BowelSize},get SoilinessPercentage(){return this.SoilinessValue/jt()},set SoilinessPercentage(e){e<0&&(e=0),this.SoilinessValue=e*jt()},get WetnessPercentage(){return this.WetnessValue/jt()},set WetnessPercentage(e){e<0&&(e=0),this.WetnessValue=e*jt()}},settings:{set Metabolism(e){Player.ABCL.Settings.Metabolism.value=e,Dt.save()},set DisableWetting(e){Player.ABCL.Settings.DisableWetting.value=e,Dt.save()},set DisableSoiling(e){Player.ABCL.Settings.DisableSoiling.value=e,Dt.save()},addCaregiver(e){Player.ABCL=dt(Player.ABCL,{Settings:{CaregiverIDs:{value:[...Player.ABCL.Settings.CaregiverIDs.value,e]}}}),Dt.save()},removeCaregiver(e){Player.ABCL=dt(Player.ABCL,{Settings:{CaregiverIDs:{value:Player.ABCL.Settings.CaregiverIDs.value.filter((t=>t!==e))}}}),Dt.save()},set OpenRemoteSettings(e){Player.ABCL.Settings.OpenRemoteSettings.value=e,Dt.save()},get Metabolism(){return Player.ABCL.Settings.Metabolism.value},get MetabolismValue(){const e=xt.get(Player.ABCL.Settings.Metabolism.value);if(void 0===e)throw new Error("Invalid metabolism value");return e},get DisableWetting(){return Player.ABCL.Settings.DisableWetting.value},get DisableSoiling(){return Player.ABCL.Settings.DisableSoiling.value},get CaregiverIDs(){return Player.ABCL.Settings.CaregiverIDs.value},get OpenRemoteSettings(){return Player.ABCL.Settings.OpenRemoteSettings.value}}},Dt=new class{constructor(e){this.lastSaveTime=0,this.allowedSaveInterval=e}save(){Date.now()-this.lastSaveTime>this.allowedSaveInterval&&(gt(),this.lastSaveTime=Date.now())}}(12e4),kt=new class{constructor(e){this.lastCallTime=0,this.allowedCallInterval=e}check(){return Date.now()-this.lastCallTime>this.allowedCallInterval&&(this.lastCallTime=Date.now(),!0)}reset(){this.lastCallTime=0}isReady(){return Date.now()-this.lastCallTime>this.allowedCallInterval}}(12e4);window.abclPlayer=Pt;const It=(e="any")=>{const t=jt();return"pee"===e?Pt.stats.WetnessValue>=t:"poop"===e?Pt.stats.SoilinessValue>=t:Pt.stats.SoilinessValue>=t||Pt.stats.WetnessValue>=t},_t=()=>{const e=jt();return Pt.stats.SoilinessValue+Pt.stats.WetnessValue>=e/2},Ft=e=>e.Asset.Description.toLowerCase().includes("diaper")&&e.Asset.Description in gn.Diapers;function Tt(e=Player){if(!e)return!1;const t=InventoryGet(e,"ItemPelvis"),n=InventoryGet(e,"Panties");return Boolean(t&&Ft(t)||n&&Ft(n))}function Et(e,t,n=.5){let o=DrawHexToRGB(e),i=DrawHexToRGB(t),s={r:Math.round(o.r*n+i.r*(1-n)),g:Math.round(o.g*n+i.g*(1-n)),b:Math.round(o.b*n+i.b*(1-n))};return DrawRGBToHex([s.r,s.g,s.b])}function $t(e,t,n,o){return e>.75?e>.9?t:Et(t,n,e-.75):Et(n,o,e)}const zt=(e,t,n,o=Player)=>{const i=InventoryGet(o,e);if(i&&Ft(i)){const e=typeof i.Asset.DefaultColor,o=gn.Diapers[i.Asset.Description];e!==typeof i.Color&&(i.Color=i.Asset.DefaultColor),"object"===e&&JSON.stringify(i.Color).includes('"Default"')&&(i.Color=JSON.parse(JSON.stringify(i.Color).replaceAll(/"Default"/g,'"#FFFFFF"')));const s=i.Color??i.Asset.DefaultColor;"primaryColor"in o&&(s[o.primaryColor]=t),"secondaryColor"in o&&(s[o.secondaryColor]=n),i.Color=s}},Ot=()=>{const e=Pt.stats.SoilinessValue/jt(),t=Pt.stats.WetnessValue/jt(),n=$t(e,gn.DiaperColors.maximummess,gn.DiaperColors.middlemess,gn.DiaperColors.clean),o=$t(t,gn.DiaperColors.maximumwet,gn.DiaperColors.middlewet,gn.DiaperColors.clean),i=Et(n,o,.7),s=Et(n,o,.9);zt("ItemPelvis",i,s,Player),zt("Panties",i,s,Player),CharacterRefresh(Player,!0),ChatRoomCharacterUpdate(Player)};function jt(e=Player){const t=InventoryGet(e,"ItemPelvis"),n=InventoryGet(e,"Panties");let o=0;return t&&Ft(t)&&(o+=Wt(t)),n&&Ft(n)&&(o+=Wt(n)),o}function Wt(e){return"Poofy Chastity Diaper"===e.Asset.Description&&1===e.Property?.TypeRecord?.typed?gn.DiaperSizeScale.heavy_adult:gn.DiaperSizeScale[gn.Diapers[e.Asset.Description].size]}function Rt(e,t,n=0,o=1){const i=(.6*Math.pow(e,2)+.8*Math.pow(t,3)+.3*n)*(1/(1+.2*o));return Math.min(Math.max(i,0),1)}const Nt=()=>{const e=Player.Appearance.map((e=>e.Asset.Description)),t=gn.BabyClothes.concat(["milk","pacifier","bib"]).filter((t=>e.some((e=>e.toLocaleLowerCase().includes(t)))));return Math.min(.25*t.length,1)},Vt=()=>{let e=0+Nt();return Player.Appearance.some((e=>gn.BabyClothes.includes(e.Asset.Description)))&&(e+=1),_t()&&(e+=.25),It()&&(e+=.5),e/9e3};function Gt(e){const t=[{time:1200,start:0,end:.25},{time:2400,start:.25,end:.5},{time:4800,start:.5,end:.75},{time:9600,start:.75,end:1}];for(const{time:n,start:o,end:i}of t)if(Pt.stats.Incontinence>=o&&Pt.stats.Incontinence<i)return e/n;return 0}const Ht=()=>{const e=1+Nt();return Pt.stats.MentalRegression<.25||.25>Pt.stats.MentalRegression&&Pt.stats.MentalRegression<.5&&_t()?e/500:.5>Pt.stats.MentalRegression&&Pt.stats.MentalRegression<.75&&It()?e/1e3:.75>Pt.stats.MentalRegression&&Pt.stats.MentalRegression<1&&It()?e/1500:0},Yt=(e=Player)=>{const t=e.MemberNumber!==Player.MemberNumber;console.log("isSomeoneElse",t,e.MemberNumber),t&&e.MemberNumber?new Ct(e.MemberNumber,"changeDiaper",999999):(Pt.stats.SoilinessValue=0,Pt.stats.WetnessValue=0,Ot())};function Ut(e){const t=ChatRoomCharacter.find((t=>t.MemberNumber===e));return t?(t?.IsPlayer(),t):null}function Xt(e){if(!e)return"Unknown";const t=Ut(e);return t?t.Nickname?t.Nickname:t.Name:"Unknown"}const qt=(e,t)=>{const n=(e=>e.MemberNumber===Player.MemberNumber?r.Self:e.IsOwnedByPlayer()?r.Owner:e.IsLoverOfPlayer()?r.Lovers:e.MemberNumber&&Player.FriendList?.includes(e.MemberNumber)?r.Friends:ServerChatRoomGetAllowItem(Player,e)?r.ItemPermission:r.Anyone)(t);return Object.entries(e).reduce(((e,[t,o])=>(o.permission.canView<=n&&(e[t]=o),e)),{})},Kt=e=>{const t={Type:"Hidden",Content:"ABCLMsg",Sender:Player.MemberNumber,Dictionary:[{message:e}]};return ServerSend("ChatRoomChat",t),t},Jt=e=>{const n=Kt({type:"sync",settings:Player.ABCL.Settings,stats:Player.ABCL.Stats,target:e});t.debug({message:`Sending updated data to ${e??"everyone"}`,data:n})},Zt=e=>{if("ABCLMsg"!==e?.Content)return;if(!e.Sender||!e.Dictionary)return;if(e.Sender===Player.MemberNumber)return;if("Hidden"!==e.Type)return;if(!e.Dictionary[0]?.message)return;const n=e.Dictionary[0].message;if("type"in n){switch(n.type){case"init":(e=>{e.Sender&&(t.debug("Received request for data"),Jt(e.Sender))})(e);break;case"sync":(e=>{if(!e.Sender)return;const n=e.Dictionary?.[0]?.message;if(!n)return;t.debug({message:"Received updated data",data:e});const o=Ut(e.Sender);o&&(o.ABCL={Settings:qt(n.settings,o),Stats:n.stats})})(e);break;case"changeDiaper":console.log(wt.get(n.id));let o=wt.get(n.id);if(!o&&("accepted"===n.state||"rejected"===n.state))return;switch(n.state){case"accepted":o.state="accepted",bt(`${Xt(e.Sender)} accepted your change diaper request.`);break;case"rejected":o.state="rejected",bt(`${Xt(e.Sender)} rejected your change diaper request.`);break;case"pending":new At(`${Xt(e.Sender)} wants to change your diaper.`,(()=>{bt(`${Xt(e.Sender)} changed your diaper.`),Yt(),Kt({type:"changeDiaper",state:"accepted",id:n.id})}),(()=>{Kt({type:"changeDiaper",state:"rejected",id:n.id})}),1e4);break;case"timedout":bt(`${Xt(e.Sender)}'s change diaper request timed out.`);break;case"cancelled":bt(`${Xt(e.Sender)} cancelled their change diaper request.`)}}}},Qt=async()=>{await async function(e,t=(()=>!1)){for(;!e();){if(t())return!1;await new Promise((e=>setTimeout(e,10)))}return!0}((()=>ServerSocket&&ServerIsConnected)),ft.hookFunction("ChatRoomSync",1,((e,t)=>(Jt(),t(e)))),ft.hookFunction("ChatRoomMessage",1,((e,n)=>"ServerEnter"===e[0].Content&&e[0].Sender===Player.MemberNumber?(Kt({type:"init"}),void t.debug("Requesting data from others.")):(Zt(e[0]),n(e)))),ft.hookFunction("CharacterAppearanceSetItem",1,((e,t)=>{const n=t(e);return Ot(),n}))};function en(e,t,n,o,i,s,r=!1,a="Black",l=200,c=45){DrawText(i,e+l,t+c,a,"Gray"),DrawButton(e,t,n,o,"",r?"#ebebe4":"White",s?"Icons/Checked.png":"",void 0,r)}function tn(e,t){if(t){return{Slow:"Normal",Normal:"Fast",Fast:"Faster",Faster:"Fastest",Fastest:"Slow"}[e]}return{Slow:"Fastest",Normal:"Slow",Fast:"Normal",Faster:"Fast",Fastest:"Faster"}[e]}const nn=[{className:"SoilinessPercentage",primary:"#d1aa98ff",secondary:"#ab674aff"},{className:"WetnessPercentage",primary:"#f3e1aeff",secondary:"#e7c463ff"},{className:"BowelFullness",primary:"#b7795cff",secondary:"#7c4c36ff"},{className:"BladderFullness",primary:"#eacd73ff",secondary:"#cba01eff"},{className:"Incontinence",primary:"#eeacacff",secondary:"#cb5b5bff"},{className:"MentalRegression",primary:"#e6bff1ff",secondary:"#ad74beff"}];let on="";for(const e of nn)on+=`\n\t.ABCL${e.className}Slider::-webkit-slider-runnable-track {\n\t\tbackground-color: ${e.primary} !important;\n\t}\n\t.ABCL${e.className}Slider::-ms-track {\n\t\tbackground-color: ${e.primary} !important;\n\t}\n\t.ABCL${e.className}Slider::-moz-range-track {\n\t\tbackground-color: ${e.primary} !important;\n\t}\n\t.ABCL${e.className}Slider::-webkit-slider-progress {\n\t\tbackground-color: ${e.secondary} !important;\n\t}\n\t.ABCL${e.className}Slider::-moz-range-progress {\n\t\tbackground-color: ${e.secondary} !important;\n\t}\n\t.ABCL${e.className}Slider::-ms-fill-lower {\n\t\tbackground-color: ${e.secondary} !important;\n\t}`;const sn=`\n\n.ABCLOverlay {\n\taspect-ratio: 2/1;\n\tmax-width: 100%;\n\tmax-height: 100%;\n\tmargin: auto;\n\tposition: relative;\n\ttransform: translateY(-50%);\n\ttop: 50%;\n\tpointer-events: none;\n  font-family: arial;\n  \n}\n.ABCLWindowHeaderTitle {\n  margin: 0;\n}\n\n.ABCLOpenStatsButton {\n  position: fixed;\n  bottom: 10px;\n  right: 10px;\n  z-index: 1000;\n  aspect-ratio: 1/1;\n  width: min-content;\n  white-space: collapse;\n  text-align: center;\n  border-radius: 5px;\n  background: #ffffffa6;\n  border: #e3e3e3 1px solid;\n  backdrop-filter: blur(4px);\n  pointer-events: all;\n}\n.ABCLOpenStatsButton:hover {\n  background: #ffffffd1;\n}\n.ABCLWindowClose {\n  aspect-ratio: 1/1;\n  background: transparent;\n  height: 29px;\n  border-radius: 0px 4px 0 0;\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  border: none;\n  border-left: 1px #0000003d solid;\n}\n.ABCLWindowMinimize {\n  aspect-ratio: 1/1;\n  background: transparent;\n  height: 29px;\n  border-radius: 0px 0px 0 0;\n  position: absolute;\n  right: 30px;\n  top: 0px;\n  border: none;\n  border-left: 1px #0000003d solid;\n}\n.ABCLWindowHeader {\n  width: 100%;\n  display: grid;\n  grid-template-columns: 1fr 29px 24px;\n  margin: -6px;\n  padding: 5px;\n  border: 1px #0000003d solid;\n  border-radius: 6px 6px 0 0;\n}\n.ABCLNotification {\n\tbackground-color: white;\n\twidth: fit-content;\n\ttext-align: center;\n\tmargin: auto;\n\tz-index: 10000;\n\tposition: absolute;\n\tbottom: 30px;\n\tleft: 25%;\n\ttransform: translateX(-50%);\n\tborder: 1px solid black;\n\tdisplay: grid;\n\tgrid-template-columns: 30px 1fr;\n\tpadding: 5px;\n\tpointer-events: all;\n}\n\n.ABCLPrompt {\n  background: white;\n  width: fit-content;\n  padding: 6px;\n  border: 1px solid black;\n  text-align: center;\n  position: absolute;\n  top: 50%;\n  left: 25%;\n  transform: translate(-50%, -50%);\n\tpointer-events: all;\n}\n.ABCLButton {\n  border: 1px #020202 solid;\n  padding: 3px;\n  margin: 4px;\n  aspect-ratio: 3/2;\n  width: 38px;\n  cursor: pointer;\n}\n.ABCLPromptYes {\n  background: #5ae85a;\n  color: black;\n}\n.ABCLPromptNo {\n  background: #ff4b4b;\n  color: white;\n}\n.ABCLClose {\n  aspect-ratio: 1/1;\n  margin: -6px;\n  background: white;\n  border: black 1px solid;\n  height: 30px;\n}\n.ABCLClose:hover {\n  background: #ff4b4b;\n  color: white;\n  cursor: pointer;\n}\n\n.ABCLStatsWindow {\n  width: 200px;\n  height: fit-content;\n  padding: 5px;\n  background: #ffffffa6;\n  border: #e3e3e3 1px solid;\n  pointer-events: all;\n  position: fixed;\n  backdrop-filter: blur(4px);\n  border-radius: 6px;\n  box-shadow: 0 4px 5px 1px #00000014;\n}\n\n.ABCLStatsWindowHeader {\n  font-size: 1.2em;\n  font-weight: bold;\n  margin: -5px;\n  padding: 5px 0 6px 8px;\n  border-bottom: black 1px solid;\n  cursor: pointer;\n}\n.ABCLStatsWindowHeader:hover {\n  background: #fbfbfb;\n}\n.ABCLStatsWindowList {\n  list-style: none; \n  padding: 0;\n  margin: 0;\n  margin-top: 10px;\n}\n\n.ABCLStatsWindowListItem {\n  display: grid;\n  grid-template-columns: 1fr min-content;\n  margin-top: 10px;\n}\n.ABCLStatsWindowListItem p {\n  margin: 0px;\n  display: inline;\n  text-align: right;\n}\n.ABCLStatsWindowListItem input {\n -webkit-appearance: none;\n appearance: none;\n grid-column: 1/-1;\n margin-top: 3px;\n}\n\n.ABCLStatsWindowListItem input::-ms-thumb {\n  -ms-appearance: none !important;\n   opacity: 0 !important;\n}\n.ABCLStatsWindowListItem input::-moz-range-thumb {\n  -moz-appearance: none !important;\n\topacity: 0 !important;\n}\n.ABCLStatsWindowListItem input::-webkit-slider-thumb {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  opacity: 0 !important;\n}\n.ABCLStatsWindowListItem input::-moz-range-track {\n  -moz-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 5px;\n  border: #999 1px solid;\n  cursor: auto !important;\n}\n.ABCLStatsWindowListItem input::-ms-track {\n  -ms-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 5px;\n  border: #999 1px solid;\n  cursor: auto !important;\n}\n.ABCLStatsWindowListItem input::-webkit-slider-runnable-track {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 5px;\n  border: #999 1px solid;\n  cursor: auto !important;\n}\n.ABCLStatsWindowListItem input::-ms-fill-lower {\n  -ms-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 4px;\n  cursor: auto !important;\n}\n.ABCLStatsWindowListItem input::-moz-range-progress {\n  -moz-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 4px;\n  cursor: auto !important;\n\n}\n.ABCLStatsWindowListItem input::-webkit-slider-progress {\n  -webkit-appearance: none !important;\n  appearance: none !important;\n  height: 18px;\n  border-radius: 4px;\n  cursor: auto !important;\n}\n\n.ABCLTextParticle {\n  position: fixed;\n  pointer-events: none;\n  transform: translateX(-50%) translateY(-50%);\n  z-index: 1000;\n  font-size: 1.5em;\n  font-weight: bold;\n  mix-blend-mode: difference;\n  -webkit-user-select: none; /* Safari */\n  -ms-user-select: none; /* IE 10 and IE 11 */\n  user-select: none; /* Standard syntax */\n  transition: all 0.5s;\n}\n\n\n.ABCLStatsWindowFolded .ABCLStatsWindowList{\n  display: none;\n}\n\n${on}\n\n.ABCLHidden {\n  display: none !important;\n}\n`;var rn={BabyClothes:["Bows Dress","Babydoll Dress","Puffy Dress","Shiny dress","Summmer flower dress","Adult Baby Harness","Tutu","Frilled Bikni","Cosplay Girl Suit","Padded Mittens","Paw Mittens","Short Smooth Leather Mittens"],DiaperColors:{clean:"#8F8F8F",middlewet:"#ffe58b",maximumwet:"#ffd33e",middlemess:"#423019",maximummess:"#3C302C",selfwet:"#242103",selfmess:"#1f170d"},DiaperSizeScale:{none:0,small:300,regular:500,overnight:800,light_adult:900,moderate_adult:1500,heavy_adult:2500,specialized:3500},Diapers:{"Patterned Diaper":{primaryColor:1,size:"overnight"},"Bulky Diaper":{primaryColor:1,secondaryColor:0,size:"light_adult"},"Bulky Chastity Diaper":{primaryColor:1,secondaryColor:0,size:"moderate_adult"},"Poofy Diaper":{primaryColor:1,secondaryColor:0,size:"light_adult"},"Poofy Chastity Diaper 1":{primaryColor:1,secondaryColor:0,size:"heavy_adult"},"Poofy Chastity Diaper":{primaryColor:1,secondaryColor:0,size:"moderate_adult"},"Plastic Covered Diaper":{primaryColor:0,size:"light_adult"},"Satin Covered Diaper":{primaryColor:0,size:"light_adult"},Diaper:{size:"regular"},"Diaper Harness":{size:"none"}}};const an=(e,t)=>!!t&&Boolean((!e.Criteria||e.Criteria(t))&&t.FocusGroup&&((e,t)=>Boolean(e.Target?.includes(t)||e.TargetSelf?.includes(t)&&Player.MemberNumber===CurrentCharacter?.MemberNumber))(e,t.FocusGroup.Name)),ln={},cn=()=>{ln.ChangeDiaper={Name:"Change Diaper",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/changeDiaper.svg",OnClick:(e,t)=>{console.log("Change diaper clicked",e),Yt(e)},Target:["ItemPelvis"],Criteria:e=>Tt(e)},ln.UsePotty={Name:"Sit and Use Potty",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/potty-temp.png",OnClick:e=>{const t=Pt.stats.BladderFullness<.3&&Pt.stats.BowelFullness<.3,n=!t,o=Pt.stats.BladderFullness>.6||Pt.stats.BowelFullness>.6,i=Pt.stats.MentalRegression<.3,s=Pt.stats.MentalRegression>.9;t?bt("You sit down but you can't seem to get anything out."):(n&&(Pt.stats.BladderFullness=0,Pt.stats.BowelFullness=0,bt("You sit down and use the potty.")),i&&(Pt.stats.MentalRegression+=.04),o&&!s&&(Pt.stats.MentalRegression-=.02,Pt.stats.Incontinence-=.02))},TargetSelf:["ItemButt"],Criteria:e=>!0},ln.UseToilet={Name:"Sit and Use Toilet",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/toilet-temp.png",OnClick:e=>{const t=Pt.stats.BladderFullness<.3&&Pt.stats.BowelFullness<.3,n=!t,o=Pt.stats.BladderFullness>.6||Pt.stats.BowelFullness>.6;t||(n&&(Pt.stats.BladderFullness=0,Pt.stats.BowelFullness=0,bt("You sit down and use the toilet.")),o&&(Pt.stats.MentalRegression-=.02,Pt.stats.Incontinence-=.02))},TargetSelf:["ItemButt"],Criteria:e=>Pt.stats.MentalRegression<.3},ln.WetDiaper={Name:"Wet Diaper",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/wetDiaper.svg",OnClick:(e,t)=>{Pt.releaseBladder()},TargetSelf:["ItemPelvis"],Criteria:e=>Tt(e)},ln.SoilDiaper={Name:"Soil Diaper",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/soilDiaper.svg",OnClick:(e,t)=>{Pt.releaseBowel()},TargetSelf:["ItemPelvis"],Criteria:e=>Tt(e)},ft.hookFunction("DialogMenuMapping.activities.GetClickStatus",1,((e,t)=>{const[n,o,i]=e;return o?t(e):null})),ft.hookFunction("DialogChangeMode",1,(async(e,t)=>{const[n]=e;if(t(e),"activities"!==n)return;const o=await(async(e,t={})=>new Promise((n=>{const o=document.querySelector(e);if(o)return void n(o);const i=new MutationObserver((()=>{const o=document.querySelector(e);o&&(!t.childCheck||o.childElementCount>0)&&(i.disconnect(),n(o))}));i.observe(document.body,{childList:!0,subtree:!0})})))("#dialog-activity-grid"),i=CurrentCharacter?.FocusGroup?.Name;i&&Object.entries(ln).forEach((([e,t])=>{an(t,CurrentCharacter??Player)&&((e=>Boolean(document.getElementById(e)))(e)||o.appendChild(((e,t,n,o)=>{const i=document.createElement("button");return i.id=t,i.name=`ABCL_${e}`,i.dataset.group="ItemArms",i.className="blank-button button button-styling HideOnPopup dialog-grid-button",i.innerHTML=`<img decoding="async" loading="lazy" src="${n}" class="button-image"><span class="button-label button-label-bottom">${e}</span>`,i.addEventListener("click",(e=>{const t=CurrentCharacter??Player,n=t?.FocusGroup?.Name;o&&n&&(o(t,n),DialogLeave())})),i})(t.Name,e,t.Image,t.OnClick)))}))}))};ft.hookFunction("TextLoad",5,((e,t)=>"WetMinigame"===CurrentScreen||"MessMinigame"===CurrentScreen?void 0:t(e)));function dn(e){var t=e.name;console.log("Registering minigame: "+t),window[t+"Run"]=()=>e.Run(),window[t+"Click"]=()=>e.Click(),window[t+"Load"]=()=>e.Load(),window[t+"Unload"]=()=>e.Unload(),window[t+"Resize"]=()=>e.Resize(),window[t+"KeyDown"]=()=>e.KeyDown(),window[t+"Exit"]=()=>e.Exit(),window[t+"End"]=t=>e.End(t)}class un{get name(){return this.constructor.name}Load(){}Unload(){}Resize(){}KeyDown(){}Exit(){}End(e){}}class pn extends un{constructor(){super(...arguments),this.startText="",this.hintText="",this.failText="",this.successText="",this.tintColor=[{r:0,g:0,b:0,a:0}],this.GameStartTime=0,this.GameEndTime=0,this.StartDelay=4e3,this.AccidentVelocity=0,this.AccidentPosition=0,this.AccidentAcceleration=0,this.AccidentMaxPosition=100,this.AccidentGameDuration=5e3,this.AccidentNextTick=0,this.AccidentText="",this.AccidentChallenge=0,this.BaseGameLength=6e3}End(e){CommonSetScreen("Online","ChatRoom"),MiniGameVictory=e,MiniGameEnded=!0,MiniGameTimer=CommonTime(),this.GameEndTime=MiniGameTimer}get IsStartDelay(){return CommonTime()<this.GameStartTime}Load(){if(DrawFlashScreen("#000000",750,1e3),this.GameStartTime=CommonTime()+this.StartDelay,this.AccidentVelocity=0,this.AccidentAcceleration=0,"number"!=typeof MiniGameDifficulty)MiniGameTimer=CommonTime()+this.BaseGameLength,this.AccidentChallenge=5;else{var e=.25*(MiniGameDifficulty-8);this.AccidentGameDuration=this.BaseGameLength+1e3*e,MiniGameTimer=this.GameStartTime+this.AccidentGameDuration,this.AccidentChallenge=MiniGameDifficulty}this.AccidentMaxPosition=400,this.AccidentPosition=this.AccidentMaxPosition,console.info("Accident minigame started: difficulty - "+this.AccidentChallenge+" time - "+this.AccidentGameDuration)}get IsGameActive(){return CommonTime()<MiniGameTimer&&!MiniGameEnded&&!this.GameFailed}get IsGameTimeout(){return CommonTime()>=MiniGameTimer&&!MiniGameEnded}get IsEndGameReport(){return CommonTime()<this.GameEndTime+5e3}get GameFailed(){return this.AccidentPosition<=0}RunGame(e){var t=(this.AccidentGameDuration+CommonTime()-MiniGameTimer)/1e3;CommonTime()>this.AccidentNextTick&&(this.AccidentNextTick=CommonTime()+400,this.AccidentAcceleration=-1.25*this.AccidentChallenge-t*Math.random()),this.AccidentVelocity=Math.min(this.AccidentVelocity,this.AccidentVelocity+.25*this.AccidentAcceleration),this.AccidentPosition>=this.AccidentMaxPosition&&(this.AccidentVelocity=Math.min(0,this.AccidentVelocity)),this.AccidentPosition>0&&(this.AccidentPosition+=this.AccidentVelocity/1e3*e*3.5),this.AccidentPosition=Math.max(0,Math.min(this.AccidentPosition,this.AccidentMaxPosition)),DrawProgressBar(500-this.AccidentMaxPosition,800,2*this.AccidentMaxPosition,50,this.AccidentPosition/this.AccidentMaxPosition*100),DrawText(this.hintText,500,875,"white","black")}Run(){ChatRoomRun(CommonTime()),this.IsStartDelay?DrawText(this.startText,500,500,"white","black"):this.IsGameActive?this.RunGame(TimerRunInterval):!this.IsGameTimeout&&!this.GameFailed||MiniGameEnded||(this.End(this.AccidentPosition>0),MiniGameEnd())}Click(){var e;this.IsGameActive&&(this.AccidentVelocity=Math.max(this.AccidentVelocity+(e=11,Math.floor(Math.random()*e)+5),20))}}class hn extends pn{constructor(){super(...arguments),this.startText="A sudden pressure builds within you...",this.hintText="Click to maintain control. Keep it together!",this.failText="Oops! You've had an accident!",this.successText="Crisis averted! You stayed composed!"}End(e){super.End(e),e?Pt.stats.Incontinence-=Gt(Pt.stats.BowelValue/100):(Pt.stats.SoilinessValue+=Pt.stats.BowelValue,Pt.stats.Incontinence+=Gt(Pt.stats.BowelValue/100),Pt.stats.BowelValue=0),Pt.onAccident()}}class mn extends pn{constructor(){super(...arguments),this.startText="You feel a trickle starting...",this.hintText="Click to squeeze tight. Don't let it get away!",this.failText="Oh no! You lost control!",this.successText="You held it in! Phew!"}End(e){super.End(e),e?Pt.stats.Incontinence-=Gt(Pt.stats.BladderValue/200):(Pt.stats.WetnessValue+=Pt.stats.BladderValue,Pt.stats.Incontinence+=Gt(Pt.stats.BladderValue/200),Pt.stats.BladderValue=0),Pt.onAccident()}}window.clearData=()=>{Player.ExtensionSettings.ABCL="N4XyA===",ServerPlayerExtensionSettingsSync("ABCL"),t.warn("cleared data")},window.saveData=gt,window.mutateData=e=>{Player.ABCL=dt(Player.ABCL||ht,e),gt()},window.noOp=()=>{};const gn=rn,fn=()=>{const e=Player.MemberNumber;if(null===e)throw t.error("No player MemberNumber"),new Error("No player MemberNumber");ft.hookFunction("LoginResponse",0,((n,o)=>{const i=n[0];if(yt(i)&&"string"==typeof i.Name&&"string"==typeof i.AccountName&&i.MemberNumber!==e){const n=`Attempting to load ABCL with different account than already loaded (${i.MemberNumber} vs ${e}). This is not supported, please refresh the page.`;throw t.error(n),alert(n),new Error(n)}return o(n)}));const n=document.createElement("style");var o;n.innerHTML=sn,document.head.appendChild(n),ServerPlayerSync(),(()=>{let e,n;const o=LZString.decompressFromBase64(Player.ExtensionSettings.ABCL);o?(t.info("Loaded settings from server"),e=JSON.parse(o).Settings,n=JSON.parse(o).Stats):(t.info("Generating new settings"),e={},n={});const i=dt({Settings:ut,Stats:pt,ModVersion:"2.0.0"},{Settings:e,Stats:n});t.debug({message:"Merged settings object",modStorageObject:i}),Player.ABCL=i})(),(async()=>{PreferenceRegisterExtensionSetting({Identifier:"ABCL",ButtonText:`${s} Settings`,Image:"https://zoe-64.github.io/ABCL/beta/assets/abcl.png",run:()=>{en(150,130,65,65,"Disable wetting",Pt.settings.DisableWetting,!1,"black",360,35),en(150,250,65,65,"Disable soiling",Pt.settings.DisableSoiling,!1,"black",340,35),DrawText("Metabolism, the speed of your bladder/bowel filling up",560,420,"black"),DrawBackNextButton(150,450,580,90,Pt.settings.Metabolism,"white","",(()=>tn(Pt.settings.Metabolism,!1)),(()=>tn(Pt.settings.Metabolism,!0)))},click:()=>{MouseIn(150,300,65,65)&&(Pt.settings.DisableWetting=!Pt.settings.DisableWetting),MouseIn(150,400,65,65)&&(Pt.settings.DisableSoiling=!Pt.settings.DisableSoiling),MouseIn(150,450,290,90)&&(Pt.settings.Metabolism=tn(Pt.settings.Metabolism,!1)),MouseIn(440,450,290,90)&&(Pt.settings.Metabolism=tn(Pt.settings.Metabolism,!0))},exit:()=>!0,load:()=>{}})})(),o=[],ft.hookFunction("TextLoad",5,((e,t)=>{if(!o.some((e=>e.module===CurrentModule&&e.id===CurrentScreen)))return t(e)})),o.forEach((e=>{window[`${e.id}Background`]="Sheet";const{KeyUp:t,Click:n,...o}=e.functions,i={...o,KeyUp:n=>{"Escape"===n.key&&window[`${e.id}Exit`](),t?.(n)},Click:t=>{MouseIn(1815,75,90,90)&&window[`${e.id}Exit`](),n?.(t)}};window[`${e.id}ScreenFunctions`]=i,Object.entries(i).forEach((([t,n])=>{window[`${e.id}${t}`]=n}))})),Qt(),t.info("Ready."),window.ABCL_Loaded=!0,cn(),dn(new hn),dn(new mn),setTimeout((()=>{Lt=new St,ft.hookFunction("ChatRoomCharacterViewDrawOverlay",1,((e,t)=>{t(e);const[n,o,i,s]=e;if(n.MemberNumber===Player.MemberNumber){const[e,t]=[o+150*s,i+400*s];Lt.openButton.style.top=`${t}px`,Lt.openButton.style.left=`${e}px`}})),document.body.appendChild(Mt)}),1500),setInterval(yn,6e4)};t.info("Waiting for possible login..."),null==CurrentScreen||"Login"===CurrentScreen?ft.hookFunction("LoginResponse",0,((e,t)=>{t(e);const n=e[0];if(yt(n)&&"string"==typeof n.Name&&"string"==typeof n.AccountName){if(window.ABCL_Loaded)return;fn()}})):(t.info("ABCL: Already logged in, loading..."),fn());const yn=()=>{Pt.update()};e.ABCLdata=gn,e.updateInterval=6e4}({});
//# sourceMappingURL=main.js.map
