!function(){"use strict";var e={};!function(e){!function(){const t="1.2.0";function n(e){alert("Mod ERROR:\n"+e);const t=new Error(e);throw console.error(t),t}const o=new TextEncoder;function r(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function s(e){const t=new Set;return e.filter((e=>!t.has(e)&&t.add(e)))}const a=new Map,i=new Set;function l(e){i.has(e)||(i.add(e),console.warn(e))}function c(e){const t=[],n=new Map,o=new Set;for(const r of h.values()){const s=r.patching.get(e.name);if(s){t.push(...s.hooks);for(const[t,a]of s.patches.entries())n.has(t)&&n.get(t)!==a&&l(`ModSDK: Mod '${r.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${t}\nPatch1:\n${n.get(t)||""}\nPatch2:\n${a}`),n.set(t,a),o.add(r.name)}}t.sort(((e,t)=>t.priority-e.priority));const r=function(e,t){if(0===t.size)return e;let n=e.toString().replaceAll("\r\n","\n");for(const[o,r]of t.entries())n.includes(o)||l(`ModSDK: Patching ${e.name}: Patch ${o} not applied`),n=n.replaceAll(o,r);return(0,eval)(`(${n})`)}(e.original,n);let s=function(t){var n,s;const a=null===(s=(n=b.errorReporterHooks).hookChainExit)||void 0===s?void 0:s.call(n,e.name,o),i=r.apply(this,t);return null==a||a(),i};for(let n=t.length-1;n>=0;n--){const o=t[n],r=s;s=function(t){var n,s;const a=null===(s=(n=b.errorReporterHooks).hookEnter)||void 0===s?void 0:s.call(n,e.name,o.mod),i=o.hook.apply(this,[t,e=>{if(1!==arguments.length||!Array.isArray(t))throw new Error(`Mod ${o.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return r.call(this,e)}]);return null==a||a(),i}}return{hooks:t,patches:n,patchesSources:o,enter:s,final:r}}function d(e,t=!1){let n=a.get(e);if(n)t&&(n.precomputed=c(n));else{let t=window;const s=e.split(".");for(let n=0;n<s.length-1;n++)if(t=t[s[n]],!r(t))throw new Error(`ModSDK: Function ${e} to be patched not found; ${s.slice(0,n+1).join(".")} is not object`);const i=t[s[s.length-1]];if("function"!=typeof i)throw new Error(`ModSDK: Function ${e} to be patched not found`);const l=function(e){let t=-1;for(const n of o.encode(e)){let e=255&(t^n);for(let t=0;t<8;t++)e=1&e?-306674912^e>>>1:e>>>1;t=t>>>8^e}return(~t>>>0).toString(16).padStart(8,"0").toUpperCase()}(i.toString().replaceAll("\r\n","\n")),d={name:e,original:i,originalHash:l};n=Object.assign(Object.assign({},d),{precomputed:c(d),router:()=>{},context:t,contextProperty:s[s.length-1]}),n.router=function(e){return function(...t){return e.precomputed.enter.apply(this,[t])}}(n),a.set(e,n),t[n.contextProperty]=n.router}return n}function u(){for(const e of a.values())e.precomputed=c(e)}function p(){const e=new Map;for(const[t,n]of a)e.set(t,{name:t,original:n.original,originalHash:n.originalHash,sdkEntrypoint:n.router,currentEntrypoint:n.context[n.contextProperty],hookedByMods:s(n.precomputed.hooks.map((e=>e.mod))),patchedByMods:Array.from(n.precomputed.patchesSources)});return e}const h=new Map;function m(e){h.get(e.name)!==e&&n(`Failed to unload mod '${e.name}': Not registered`),h.delete(e.name),e.loaded=!1,u()}function g(e,t){e&&"object"==typeof e||n("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||n("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let o=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||n(`Failed to register mod ${o}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),o=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&n(`Failed to register mod ${o}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&n(`Failed to register mod ${o}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||n(`Failed to register mod ${o}: Expected options to be undefined or object, got ${typeof t}`);const s=!0===t.allowReplace,a=h.get(e.name);a&&(a.allowReplace&&s||n(`Refusing to load mod ${o}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),m(a));const i=e=>{let t=p.patching.get(e.name);return t||(t={hooks:[],patches:new Map},p.patching.set(e.name,t)),t},l=(e,t)=>(...r)=>{var s,a;const i=null===(a=(s=b.errorReporterHooks).apiEndpointEnter)||void 0===a?void 0:a.call(s,e,p.name);p.loaded||n(`Mod ${o} attempted to call SDK function after being unloaded`);const l=t(...r);return null==i||i(),l},c={unload:l("unload",(()=>m(p))),hookFunction:l("hookFunction",((e,t,r)=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const s=d(e),a=i(s);"number"!=typeof t&&n(`Mod ${o} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof r&&n(`Mod ${o} failed to hook function '${e}': Expected hook function, got ${typeof r}`);const l={mod:p.name,priority:t,hook:r};return a.hooks.push(l),u(),()=>{const e=a.hooks.indexOf(l);e>=0&&(a.hooks.splice(e,1),u())}})),patchFunction:l("patchFunction",((e,t)=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const s=d(e),a=i(s);r(t)||n(`Mod ${o} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[r,s]of Object.entries(t))"string"==typeof s?a.patches.set(r,s):null===s?a.patches.delete(r):n(`Mod ${o} failed to patch function '${e}': Invalid format of patch '${r}'`);u()})),removePatches:l("removePatches",(e=>{"string"==typeof e&&e||n(`Mod ${o} failed to patch a function: Expected function name string, got ${typeof e}`);const t=d(e);i(t).patches.clear(),u()})),callOriginal:l("callOriginal",((e,t,r)=>{"string"==typeof e&&e||n(`Mod ${o} failed to call a function: Expected function name string, got ${typeof e}`);const s=d(e);return Array.isArray(t)||n(`Mod ${o} failed to call a function: Expected args array, got ${typeof t}`),s.original.apply(null!=r?r:globalThis,t)})),getOriginalHash:l("getOriginalHash",(e=>("string"==typeof e&&e||n(`Mod ${o} failed to get hash: Expected function name string, got ${typeof e}`),d(e).originalHash)))},p={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:s,api:c,loaded:!0,patching:new Map};return h.set(e.name,p),Object.freeze(c)}function f(){const e=[];for(const t of h.values())e.push({name:t.name,fullName:t.fullName,version:t.version,repository:t.repository});return e}let b;const y=void 0===window.bcModSdk?window.bcModSdk=function(){const e={version:t,apiVersion:1,registerMod:g,getModsInfo:f,getPatchingInfo:p,errorReporterHooks:Object.seal({apiEndpointEnter:null,hookEnter:null,hookChainExit:null})};return b=e,Object.freeze(e)}():(r(window.bcModSdk)||n("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&n(`Failed to init Mod SDK: Different version already loaded ('1.2.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==t&&alert(`Mod SDK warning: Loading different but compatible versions ('1.2.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk);Object.defineProperty(e,"__esModule",{value:!0}),e.default=y}()}(e);var t,n=(t=e)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;const o=new class{constructor(){this.logs=[],this.maxLogSize=100}log(e,t,n){const o={message:t,level:e,version:"2.0.1",timestamp:(new Date).toISOString()};n("%cABCL:","font-weight: bold; color: #f6cbde;",o),this.logs.push(o),this.logs.length>this.maxLogSize&&this.logs.shift()}info(e){this.log("INFO",e,console.log)}debug(e){this.log("DEBUG",e,console.debug)}warn(e){this.log("WARN",e,console.warn)}error(e){this.log("ERROR",e,console.error)}getLogs(){return this.logs}};const r={ItemDefinitions:{BabyItems:["Bows Dress","Babydoll Dress","Puffy Dress","Shiny dress","Summmer flower dress","Adult Baby Harness","Tutu","Frilled Bikni","Cosplay Girl Suit","Padded Mittens","Paw Mittens","Short Smooth Leather Mittens","Changing Table","Crib","Fox Plush","Bunny Plush","Shark Plush"],Pants:["Long Leggings","Short Leggings","Business Trousers","Latex Pants","Long Latex Pants","Ripped Jeans","Jeans","Pajama"]},DiaperColors:{clean:"#8F8F8F",middlewet:"#ffe58b",maximumwet:"#ffd33e",middlemess:"#423019",maximummess:"#3C302C",selfwet:"#242103",selfmess:"#1f170d"},DiaperSizeScale:{none:0,small:300,regular:500,overnight:800,light_adult:900,moderate_adult:1500,heavy_adult:2500,specialized:3500},Diapers:{"Patterned Diaper":{primaryColor:1,size:"overnight"},"Bulky Diaper":{primaryColor:1,secondaryColor:0,size:"light_adult"},"Bulky Chastity Diaper":{primaryColor:1,secondaryColor:0,size:"moderate_adult"},"Poofy Diaper":{primaryColor:1,secondaryColor:0,size:"light_adult"},"Poofy Chastity Diaper 1":{primaryColor:1,secondaryColor:0,size:"heavy_adult"},"Poofy Chastity Diaper":{primaryColor:1,secondaryColor:0,size:"moderate_adult"},"Plastic Covered Diaper":{primaryColor:0,size:"light_adult"},"Satin Covered Diaper":{primaryColor:0,size:"light_adult"},Diaper:{size:"regular"},"Diaper Harness":{size:"none"}}},s="2.0.1",a="ABCL",i="ABCL",l=e=>{if(e)return"object"==typeof e?e:ChatRoomCharacter.find((t=>t.MemberNumber==e||t.Name.toLowerCase()===e||t.Nickname?.toLowerCase()===e))},c=(e,t=Player.ABCL.Version)=>Boolean(e?.ABCL&&e.ABCL.Version===t);function d(e){if(!e)return"Unknown";const t=l(e);return t?t.Nickname?t.Nickname:t.Name:"Unknown"}function u(e,t=null,n=""){let o=e,r="He/Him"===CharacterPronounDescription(Player),s=r?"His":"Her",a=r?"Him":"Her",i=r?"He":"She",l="He/Him"===(t?CharacterPronounDescription(t):"They/Them"),c=t?.IsPlayer()?l?"himself":"herself":t?CharacterNickname(t):n,d=l?"His":"Her",u=t==Player?l?"Himself":"Herself":l?"Him":"Her",p=l?"He":"She";return o.replaceAll("%NAME%",CharacterNickname(Player)).replaceAll("%POSSESSIVE%",s.toLocaleLowerCase()).replaceAll("%PRONOUN%",i.toLocaleLowerCase()).replaceAll("%INTENSIVE%",a.toLocaleLowerCase()).replaceAll("%CAP_POSSESSIVE%",s).replaceAll("%CAP_PRONOUN%",i).replaceAll("%CAP_INTENSIVE%",a).replaceAll("%OPP_NAME%",c).replaceAll("%OPP_PRONOUN%",p.toLocaleLowerCase()).replaceAll("%OPP_POSSESSIVE%",d.toLocaleLowerCase()).replaceAll("%OPP_INTENSIVE%",u.toLocaleLowerCase()).replaceAll("%CAP_OPP_PRONOUN%",p).replaceAll("%CAP_OPP_POSSESSIVE%",d).replaceAll("%CAP_OPP_INTENSIVE%",u)}function p(e,t=null){let n=u(e,t);ServerSend("ChatRoomChat",{Content:"Beep",Type:"Action",Dictionary:[{Tag:"Beep",Text:"msg"},{Tag:"发送私聊",Text:"msg"},{Tag:"Biep",Text:"msg"},{Tag:"Sonner",Text:"msg"},{Tag:"msg",Text:n}]})}function h(e){let t=0,n=0,o=0;return 7===e.length&&(t=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),o=parseInt(e.substring(5,7),16)),m(t,n,o)}function m(e,t,n){e/=255,t/=255,n/=255;let o,r=Math.max(e,t,n),s=Math.min(e,t,n),a=0,i=(r+s)/2;if(r===s)a=o=0;else{let l=r-s;switch(o=i>.5?l/(2-r-s):l/(r+s),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a*=60}return`hsl(${Math.round(a)}, ${Math.round(100*o)}%, ${Math.round(100*i)}%)`}function g(e,t,n){let o=function(e){let t=getComputedStyle(document.documentElement).getPropertyValue(e).trim();if(!t)return"";if(t.startsWith("#"))return h(t);const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n){const[e,t,o]=n.slice(1,4).map(Number);return m(e,t,o)}return t.match(/hsl\((\d+),\s*(\d+)%?,\s*(\d+)%?\)/)?t:""}(t);o||(o=n);return Object.entries({50:50,100:40,200:30,300:20,400:10,500:5,600:0,700:-10,800:-20,900:-30,950:-40}).map((([t,n])=>`  --sl-${e}-${t}: ${function(e,t){const n=e.match(/hsl\((\d+),\s*(\d+)%?,\s*(\d+)%?\)/);if(!n)return e;let o=parseInt(n[1],10),r=parseInt(n[2],10),s=parseInt(n[3],10);return s=Math.min(100,Math.max(0,s+t)),`hsl(${o}, ${r}%, ${s}%)`}(o,n)};`)).join("\n")}class f{constructor(){this.folded=!1,this.statsDrawer=document.createElement("sl-drawer"),this.statsDrawer.innerHTML=`\n    <p class="ABCLWindowHeaderTitle">Stats</p>\n    <sl-select id="ABCLCurrentPlayerSelect" value="${Player.MemberNumber}">\n    </sl-select>\n\n  \n\t\t<div class="ABCLStatsWindowContent">\n      <label id="SoilinessPercentage">Soiliness</label>\n      <sl-progress-bar label="Soiliness" class="ABCLSoilinessPercentage"></sl-progress-bar>\n      <label id="WetnessPercentage">Wetness</label>\n      <sl-progress-bar label="Wetness" class="ABCLWetnessPercentage"></sl-progress-bar>\n      <label id="BowelFullness">Bowel</label>\n      <sl-progress-bar label="Bowel Fullness" class="ABCLBowelFullness"></sl-progress-bar>\n      <label id="BladderFullness">Bladder</label>\n      <sl-progress-bar label="Bladder Fullness" class="ABCLBladderFullness"></sl-progress-bar>\n      <label id="Incontinence">Incontinence</label>\n      <sl-progress-bar label="Incontinence" class="ABCLIncontinence"></sl-progress-bar>\n      <label id="MentalRegression">Mental Regression</label>\n      <sl-progress-bar label="Mental Regression" class="ABCLMentalRegression"></sl-progress-bar>\n\t\t</div>\n   <sl-button class="ABCLRefreshButton">Refresh</sl-button>\n\t`,v.appendChild(this.statsDrawer),this.statsDrawer.querySelector("#ABCLCurrentPlayerSelect")?.addEventListener("sl-change",(()=>this.update())),this.statsDrawer.querySelector(".ABCLRefreshButton")?.addEventListener("click",(()=>this.update())),this.update()}close(){this.statsDrawer.removeAttribute("open")}open(e){if(this.statsDrawer.setAttribute("open","true"),void 0!==e){const t=this.statsDrawer.querySelector("#ABCLCurrentPlayerSelect");t&&(t.value=e.toString())}this.update()}async update(){const e=this.statsDrawer.querySelector("#ABCLCurrentPlayerSelect");if(!e)return;let t=l(e.value);t&&t?.ABCL||(t=Player),e.innerHTML="";for(let t of ChatRoomCharacter)t.ABCL&&(e.innerHTML+=`<sl-option value="${t.MemberNumber}">${d(t.MemberNumber)}</sl-option>`);const n=(e,t)=>{t=Math.round(t);const n=this.statsDrawer.querySelector(`.ABCL${e}`),o=this.statsDrawer.querySelector(`#${e}`);if(!n||!o)return;const r=Math.round(10*(t+Number.EPSILON))/10;t>=100?(n.value="100",n.innerText=`overflowing ${Math.round((t-100)/(t/100))}%`,o.innerText=`${o.innerText.split(":")[0]}: overflowing ${r-100}%`):(n.value=r.toString(),n.innerText=r.toString()+"%",o.innerText=o.innerText.split(":")[0]+": "+r.toString()+"%")};t.ABCL&&(Cn(t)?(n("SoilinessPercentage",t.ABCL.Stats.Soiliness.value/Pn(t)*100),n("WetnessPercentage",t.ABCL.Stats.Wetness.value/Pn(t)*100)):(n("SoilinessPercentage",0),n("WetnessPercentage",0)),n("BowelFullness",t.ABCL.Stats.Bowel.value/t.ABCL.Stats.Bowel.size*100),n("BladderFullness",t.ABCL.Stats.Bladder.value/t.ABCL.Stats.Bladder.size*100),n("Incontinence",100*t.ABCL.Stats.Incontinence.value),n("MentalRegression",100*t.ABCL.Stats.MentalRegression.value))}}class b{constructor(e,t=!1){this.newX=0,this.newY=0,this.oldX=0,this.oldY=0,this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,this.edgeThreshold=10,this.resizable=!0,this.element=e,this.resizable=t,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onMouseMoveForCursor=this.onMouseMoveForCursor.bind(this),this.element.addEventListener("mousedown",this.onMouseDown),this.element.addEventListener("mousemove",this.onMouseMoveForCursor),this.element.style.position="fixed",this.resizable&&(this.element.style.resize="none",this.element.addEventListener("mouseenter",this.onMouseEnter),this.element.addEventListener("mouseleave",this.onMouseLeave))}onMouseEnter(e){this.element.addEventListener("mousemove",this.onMouseMoveForCursor)}onMouseLeave(e){this.element.removeEventListener("mousemove",this.onMouseMoveForCursor),this.element.style.cursor="default"}onMouseMoveForCursor(e){const{offsetX:t,offsetY:n}=e,{offsetWidth:o,offsetHeight:r}=this.element;this.resizable&&(t<this.edgeThreshold||t>o-this.edgeThreshold?this.element.style.cursor="ew-resize":n<this.edgeThreshold||n>r-this.edgeThreshold?this.element.style.cursor="ns-resize":this.element.style.cursor="default")}onMouseDown(e){const{offsetX:t,offsetY:n}=e,{offsetWidth:o,offsetHeight:r}=this.element;this.resizable?t<this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="left"):t>o-this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="right"):n<this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="top"):n>r-this.edgeThreshold?(this.isResizing=!0,this.resizeDirection="bottom"):this.isDragging=!0:this.isDragging=!0,(this.isDragging||this.isResizing)&&(e.preventDefault(),this.oldX=e.clientX,this.oldY=e.clientY,document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}onMouseMove(e){if(this.isDragging)this.newX=this.oldX-e.clientX,this.newY=this.oldY-e.clientY,this.oldX=e.clientX,this.oldY=e.clientY,this.element.style.top=this.element.offsetTop-this.newY+"px",this.element.style.left=this.element.offsetLeft-this.newX+"px";else if(this.isResizing){const t=e.clientX-this.oldX,n=e.clientY-this.oldY,o=getComputedStyle(this.element),r=parseInt(o.left,10),s=parseInt(o.top,10),a=parseInt(o.width,10),i=parseInt(o.height,10);switch(this.resizeDirection){case"left":this.element.style.width=a-t+"px",this.element.style.left=`${r+t/2}px`;break;case"right":this.element.style.width=`${a+t}px`,this.element.style.left=`${r+t/2}px`;break;case"top":this.element.style.height=i-n+"px",this.element.style.top=`${s+n/2}px`;break;case"bottom":this.element.style.height=`${i+n}px`,this.element.style.top=`${s+n/2}px`}this.oldX=e.clientX,this.oldY=e.clientY}}onMouseUp(e){e.preventDefault(),this.isDragging=!1,this.isResizing=!1,this.resizeDirection=null,document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}}class y{constructor(e,t,n,o=-1){this.prompt=document.createElement("div"),new b(this.prompt),this.id=dn(),this.message=e,this.onAccept=t,this.onDeny=n,this.show(),-1!==o&&setTimeout((()=>{this.prompt.remove()}),o)}show(){this.prompt.classList.add("ABCLPrompt"),this.prompt.id=this.id,this.prompt.innerHTML=`<p>${this.message}</p><button class="ABCLPromptNo ABCLButton">Deny</button><button class="ABCLPromptYes ABCLButton">Accept</button>`,v.appendChild(this.prompt),this.prompt.querySelector(`#${this.id} .ABCLPromptYes`)?.addEventListener("click",(()=>{this.onAccept(),this.prompt.remove()})),this.prompt.querySelector(`#${this.id} .ABCLPromptNo`)?.addEventListener("click",(()=>{this.onDeny(),this.prompt.remove()}))}}const v=document.createElement("div");let C;v.classList.add("ABCLOverlay");const A=()=>{const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.0/cdn/themes/light.css",document.head.appendChild(e);const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.0/cdn/themes/dark.css",document.head.appendChild(t);const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.0/cdn/shoelace-autoloader.js",n.type="module",n.async=!0,document.head.appendChild(n);const o=document.createElement("style");o.innerHTML=(()=>{const e=g("color-primary","--tmd-accent",h("#0284c7"))+g("color-neutral","--tmd-element",h("#52525b")),t=[{className:"SoilinessPercentage",primary:"#d1aa98ff",secondary:"#ab674aff"},{className:"WetnessPercentage",primary:"#f3e1aeff",secondary:"#e7c463ff"},{className:"BowelFullness",primary:"#b7795cff",secondary:"#7c4c36ff"},{className:"BladderFullness",primary:"#eacd73ff",secondary:"#cba01eff"},{className:"Incontinence",primary:"#eeacacff",secondary:"#cb5b5bff"},{className:"MentalRegression",primary:"#e6bff1ff",secondary:"#ad74beff"}];let n="";for(const e of t)n+=`\n  .ABCL${e.className} {\n    margin-bottom: 10px;\n    margin-top: 3px;\n  }\n\t.ABCL${e.className}::part(base) {\n\t\tbackground-color: ${e.primary};\n\t}\n  .ABCL${e.className}::part(indicator) {\n    background-color: ${e.secondary};\n  }`;return`\n#ABCLCurrentPlayerSelect {\n  margin-bottom: 5px;\n}\n\n.ABCLOverlay {\n\taspect-ratio: 2/1;\n\tmax-width: 100%;\n\tmax-height: 100%;\n\tmargin: auto;\n\tposition: relative;\n\ttransform: translateY(-50%);\n\ttop: 50%;\n\tpointer-events: none;\n  font-family: arial;\n  color: var(--tmd-text, --sl-color-neutral-700);\n  order: 100;\n  z-index: 10000;\n}\n.ABCLWindowHeaderTitle {\n  margin: 5px;\n  font-size: 32px;\n  font-weight: bold;\n}\n\n.ABCLOpenStatsButton {\n  position: fixed;\n  bottom: 10px;\n  right: 10px;\n  z-index: 1000;\n  aspect-ratio: 1/1;\n  width: 4%;\n  white-space: collapse;\n  text-align: center;\n  border-radius: 5px;\n  background: #ffffffa6;\n  border: #e3e3e3 1px solid;\n  backdrop-filter: blur(4px);\n  pointer-events: all;\n  font-size: clamp(9px, 1.3vw, 43px);\n  cursor: pointer;\n}\n.ABCLOpenStatsButton:hover {\n  background: #ffffffd1;\n}\n.ABCLWindowClose {\n  aspect-ratio: 1/1;\n  background: transparent;\n  height: 29px;\n  border-radius: 0px 4px 0 0;\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  border: none;\n  border-left: 1px #0000003d solid;\n}\n.ABCLWindowMinimize {\n  aspect-ratio: 1/1;\n  background: transparent;\n  height: 29px;\n  border-radius: 0px 0px 0 0;\n  position: absolute;\n  right: 30px;\n  top: 0px;\n  border: none;\n  border-left: 1px #0000003d solid;\n}\n.ABCLWindowHeader {\n  width: 100%;\n  display: grid;\n  grid-template-columns: 1fr 29px 24px;\n  margin: -6px;\n  padding: 5px;\n  border: 1px #0000003d solid;\n  border-radius: 6px 6px 0 0;\n}\n.ABCLNotification {\n\tbackground-color: white;\n\twidth: fit-content;\n\ttext-align: center;\n\tmargin: auto;\n\tz-index: 10000;\n\tposition: absolute;\n\tbottom: 30px;\n\tleft: 25%;\n\ttransform: translateX(-50%);\n\tborder: 1px solid black;\n\tdisplay: grid;\n\tgrid-template-columns: 30px 1fr;\n\tpadding: 5px;\n\tpointer-events: all;\n}\n\n.ABCLPrompt {\n  background: white;\n  width: fit-content;\n  padding: 6px;\n  border: 1px solid black;\n  text-align: center;\n  position: absolute;\n  top: 50%;\n  left: 25%;\n  transform: translate(-50%, -50%);\n\tpointer-events: all;\n}\n.ABCLButton {\n  border: 1px #020202 solid;\n  padding: 3px;\n  margin: 4px;\n  aspect-ratio: 3/2;\n  width: 38px;\n  cursor: pointer;\n}\n.ABCLPromptYes {\n  background: #5ae85a;\n  color: black;\n}\n.ABCLPromptNo {\n  background: #ff4b4b;\n  color: white;\n}\n\n.ABCLClose:hover {\n  background: #ff4b4b;\n  color: white;\n  cursor: pointer;\n}\n\n.ABCLStatsWindow {\n  width: 200px;\n  height: fit-content;\n  padding: 5px;\n  background: #ffffffa6;\n  border: #e3e3e3 1px solid;\n  pointer-events: all;\n  position: fixed;\n  backdrop-filter: blur(4px);\n  border-radius: 6px;\n  box-shadow: 0 4px 5px 1px #00000014;\n}\n\n.ABCLSettingPage {\n  width: 81%;\n  margin: 6% auto;\n  pointer-events: all;\n}\n.ABCLAddCaregiver {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  width: 25rem;\n}\n.ABCLAddCaregiverButton {\n  margin-left: 5px;\n}\n.ABCLAddCaregiverInput {\n  margin-right: 5px;\n  flex: 1;\n}\n.ABCLCaregiverLabel {\n  margin-top: 1em;\n  display: block;\n}\n.ABCLCaregiverList {\n  list-style: none;\n  border: solid var(--sl-input-border-width) var(--sl-input-border-color);\n  border-radius: var(--sl-input-border-radius-medium);\n  padding: 0rem 0rem;\n  width: fit-content;\n  min-width: 17em;\n  max-height: 15em;\n  overflow-y: scroll;\n  font-size: var(--sl-button-font-size-medium);\n  line-height: calc(var(--sl-input-height-medium) - var(--sl-input-border-width) * 2);\n}\n.ABCLCaregiver {\n  padding: 0.3rem;\n  border: solid var(--sl-input-border-width) var(--sl-input-border-color);\n  display: flex;\n}\n.ABCLRemoveCaregiver {\n  aspect-ratio: 1;\n  width: fit-content;\n  margin-left: 0.5em;\n}\n.ABCLCaregiverName {\n  flex: 1;\n}\n.ABCLRemoveCaregiver::part(base) {\n  background: #ff7b7b;\n  color: white;\n  font-weight: bold;\n}\n.ABCLSettingPage sl-checkbox {\n  display: block;\n  margin: 1rem 0;\n  width: fit-content;\n}\n.sl-theme-light, .sl-theme-dark {\n  --sl-toggle-size-small: 0.875rem;\n  --sl-toggle-size-medium: 1.125rem;\n  --sl-toggle-size-large: 1.375rem;\n\n  --sl-input-height-small: 1.875em;\n  --sl-input-height-medium: 2.5em;\n  --sl-input-height-large: 3.125em;\n\n  --sl-letter-spacing-loose: 0.075em;\n  --sl-letter-spacing-looser: 0.15em;\n\n  --sl-font-size-large: 1.25em;\n  --sl-font-size-x-large: 1.5em;\n  --sl-font-size-2x-large: 2.25em;\n  --sl-font-size-3x-large: 3em;\n  --sl-font-size-4x-large: 4.5em;\n  \n  --sl-spacing-3x-small: 0.125em;\n  --sl-spacing-2x-small: 0.25em;\n  --sl-spacing-x-small: 0.5em;\n  --sl-spacing-small: 0.75em;\n  --sl-spacing-medium: 1em;\n  --sl-spacing-large: 1.25em;\n  --sl-spacing-x-large: 1.75em;\n  --sl-spacing-2x-large: 2.25em;\n  --sl-spacing-3x-large: 3em;\n  --sl-spacing-4x-large: 4.5em;\n\n  --sl-border-radius-small: 0.1875em;\n  --sl-border-radius-medium: 0.25em;\n  --sl-border-radius-large: 0.5em;\n  --sl-border-radius-x-large: 1em;\n\n  --sl-font-size-2x-small: 1.2vmin;\n  --sl-font-size-x-small: 1.4vmin;\n  --sl-font-size-small: 1.6vmin;\n  --sl-font-size-medium: 1.6vmin;\n  --sl-font-size-large: 2.5vmin;\n  --sl-font-size-x-large: 3vmin;\n  --sl-font-size-2x-large: 4.5vmin;\n  --sl-font-size-3x-large: 6vmin;\n  --sl-font-size-4x-large: 9vmin;\n}\n.ABCLoverlay sl-tab,.ABCLoverlay sl-radio-button,.ABCLoverlay sl-checkbox {\n  pointer-events: all;\n}\n\n\n\n\n\n${n}\n\n.ABCLHidden {\n  display: none !important;\n}\n:root, :host, .sl-theme-light, .sl-theme-dark {\n${e}\n}\n\n.ABCLoverlay sl-radio-button::part(button),\n  .ABCLoverlay sl-tab::part(base), \n  .ABCLoverlay sl-tab::part(base).tab {\n  background-color: var(--tmd-element,  var(--sl-color-neutral-0));\n  color: var(--tmd-text,  var(--sl-color-neutral-700));\n}\n.ABCLoverlay sl-radio-button::part(label) {\n  color: var(--tmd-text,  var(--sl-color-neutral-700));\n}\n.ABCLoverlay sl-tab::part(base) {\n  color: var(--tmd-text, --sl-color-neutral-700);\n  background-color: var(--tmd-element-hover,  var(--sl-color-neutral-0));\n}\n.ABCLoverlay sl-tab::part(base):hover {\n  color: var(--tmd-text, --sl-color-neutral-0);\n  background-color: var(--tmd-element-hover,  var(--sl-color-primary-600));\n}\n\nsl-radio-button::part(button), sl-tab::part(base) {\n  color: var(--tmd-text, --sl-color-neutral-700);\n  background-color: var(--tmd-element,  var(--sl-color-neutral-0));\n  \n}\nsl-tab::part(base) {\n  border-radius: 0;\n}\nsl-radio-button::part(button) {\n    border: var(--tmd-element,  var(--sl-color-neutral-200)) 1px solid;\n}\n\nsl-radio-button::part(button):hover, sl-tab::part(base):hover {\n  color: var(--tmd-text, --sl-color-neutral-0);\n  background-color: var(--tmd-element-hover,  var(--sl-color-primary-600));\n}\nsl-radio-button::part(button):hover {\n  border: var(--tmd-element-hover,  var(--sl-color-primary-600)) 1px solid;\n}\n\nsl-radio-button::part(button--checked), sl-tab[aria-selected="true"]::part(base) {\n  color: var(--tmd-text, --sl-color-neutral-0);\n  background-color: var(--tmd-accent,  var(--sl-color-primary-600));\n}\nsl-radio-button::part(button--checked):hover ,sl-tab[aria-selected="true"]::part(base):hover {\n  background-color: var(--tmd-accent-hover);\n}\n\nsl-button::part(base) {\n  background-color: var(--tmd-element,  var(--sl-color-neutral-0));\n  border-color: var(--tmd-accent,  var(--sl-color-primary-600));\n}\nsl-button::part(base):hover {\n   background-color: var(--tmd-element-hover,  var(--sl-color-primary-600));\n   border-color: var(--tmd-accent-hover,  var(--sl-color-primary-600));\n}\nsl-button::part(base):active {\n  background-color: var(--tmd-accent-hover,  var(--sl-color-primary-700));\n  border-color: var(--tmd-accent-hover,  var(--sl-color-primary-700));\n}\nsl-button::part(label) {\n  color: var(--tmd-text,  var(--sl-color-neutral-700));\n}\nsl-button::part(label) {\n  color: var(--tmd-text,  var(--sl-color-neutral-700));\n}\nsl-button {\n    margin: 0.5em 0;\n}\nsl-drawer::part(panel) {\n  background-color: var(--tmd-element,  var(--sl-color-neutral-0));\n}\n\n/* sorry fusam */\n#fusam-addon-manager-container {\n  position: absolute;\n  top: 0;\n}\n`})(),document.head.appendChild(o),C=new f,v.classList.add((Player.ChatSettings?.ColorTheme??"Light").startsWith("Light")?"sl-theme-light":"sl-theme-dark"),v.style.color=(Player.ChatSettings?.ColorTheme??"Light").startsWith("Light")?"var(--tmd-text,black)":"var(--tmd-text,white)",document.body.appendChild(v),cn("#chat-room-div",{childCheck:!0,timeout:1e22}).then((()=>{cn(".ABCLOverlay",{timeout:1e22}).then((()=>{document.removeChild(v),setTimeout((()=>{document.appendChild(v)}),1e3)}))}))},S=e=>{e.MemberNumber===Player.MemberNumber?w(e):Vn("changeDiaper-pending",void 0,e.MemberNumber)},w=e=>{e.MemberNumber!==Player.MemberNumber?p(u("%OPP_NAME% changes %NAME%'s diaper.",e)):p(u("%NAME% changes %INTENSIVE% diaper.",e)),mn.stats.SoilinessValue=0,mn.stats.WetnessValue=0,Mn()},M={activity:{ID:"diaper-change",Name:"Change Diaper",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/changeDiaper.svg",OnClick:(e,t)=>{S(e)},Target:["ItemPelvis"],Criteria:e=>Cn(e)&&c(e)},command:{Tag:"diaper-change",Description:" [MemberNumber|Name|Nickname]: Changes someone's diaper.",Action:(e,t,n)=>{const o=l(n[0]);o?(M.activity.Criteria(o)||ln("Is either not diapered or not an ABCL player."),S(o)):ln(`Could not find character: "${n[0]}"`)}},listeners:{"changeDiaper-accepted":({Sender:e})=>{ln(`${d(e)} accepted your change diaper request.`)},"changeDiaper-rejected":({Sender:e})=>{ln(`${d(e)} rejected your change diaper request.`)},"changeDiaper-pending":({Sender:e})=>{switch(mn.settings.OnDiaperChange){case O.Ask:new y(`${d(e)} wants to change your diaper.`,(()=>{w(l(e)??Player),Vn("changeDiaper-accepted",void 0,e)}),(()=>{Vn("changeDiaper-rejected",void 0,e)}),1e4);break;case O.Allow:S(l(e)??Player),Vn("changeDiaper-accepted",void 0,e);break;case O.Deny:Vn("changeDiaper-rejected",void 0,e)}}}},P=e=>{if(!(Math.random()<.75))return Cn(e)?e.MemberNumber!==Player.MemberNumber?p(u("%OPP_NAME% checks %NAME%'s diaper.",e)):p(u("%NAME% checks %INTENSIVE% diaper.",e)):(e.MemberNumber!==Player.MemberNumber&&p(u("%OPP_NAME% checks %NAME%'s clothes for any accidents.",e)),p(u("%NAME% checks %INTENSIVE% clothes for any accidents.",e)))},B={activity:{ID:"check-diaper",Name:"Check Diaper",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/diaperCheck.png",OnClick:(e,t)=>{P(e),C.open(e.MemberNumber)},Target:["ItemPelvis"],Criteria:e=>c(e)},command:{Tag:"check-diaper",Description:" [MemberNumber|Name|Nickname]: Checks someone's diaper.",Action:(e,t,n)=>{const o=l(n[0]);o?(B.activity.Criteria(o)||ln("Is either not diapered or not an ABCL player."),P(o),C.open(o.MemberNumber)):ln(`Could not find character: "${n[0]}"`)}}},L={listeners:{sync:({Sender:e},t)=>{if(!e)return;console.log("sync:ABCL"),o.debug({message:"Received updated data",data:t});const n=l(e);n&&(n.ABCL={Settings:t.settings,Stats:t.stats,Version:t.version})},init:({Sender:e})=>{console.log("init"),o.debug("Received request for data"),Gn(e)}}},x={activity:{ID:"pee",Name:"Pee",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/wetDiaper.svg",OnClick:(e,t)=>{mn.wet()},TargetSelf:["ItemPelvis"]},command:{Tag:"pee",Description:" Lets go of your bladder.",Action:(e,t,n)=>{mn.wet()}}},D={activity:{ID:"poop",Name:"Poop",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/soilDiaper.svg",OnClick:(e,t)=>{mn.soil()},TargetSelf:["ItemPelvis"]},command:{Tag:"poop",Description:" Relaxes your bowels.",Action:()=>{mn.soil()}}},k=()=>{const e=mn.stats.BladderFullness<.3&&mn.stats.BowelFullness<.3,t=mn.stats.BladderFullness>.6||mn.stats.BowelFullness>.6,n=mn.stats.MentalRegression<.3,o=mn.stats.MentalRegression>.9;if(e)return void p("%NAME% tries to use the potty but can't seem to get anything out.");mn.stats.BladderFullness=0,mn.stats.BowelFullness=0;let r="";n&&(r="and feels embarrased",mn.stats.MentalRegression+=.04),t&&!o&&(n?r+=" but is releaved":r="and feels releaved",mn.stats.MentalRegression-=.02,mn.stats.Incontinence-=.02),p("%NAME% sits down uses the potty "+r+".")},E={activity:{ID:"potty",Name:"Sit and Use Potty",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/potty-temp.png",OnClick:e=>{k()},TargetSelf:["ItemButt"]},command:{Tag:"use-potty",Description:" Sit down and use the potty.",Action:(e,t,n)=>{k()}}},I=()=>{const e=mn.stats.BladderFullness<.3&&mn.stats.BowelFullness<.3,t=mn.stats.BladderFullness>.6||mn.stats.BowelFullness>.6;if(e)return ln("You try to use the toilet but you can't seem to get anything out.");mn.stats.BladderFullness=0,mn.stats.BowelFullness=0;let n="";t&&(n="and feels releaved",mn.stats.MentalRegression-=.02,mn.stats.Incontinence-=.02),p("%NAME% goes to the bathroom uses the toilet "+n+".")},N={activity:{ID:"toilet",Name:"Sit and Use Toilet",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/toilet-temp.png",OnClick:e=>{I()},TargetSelf:["ItemButt"],Criteria:e=>(mn.stats.MentalRegression,mn.stats.MentalRegression<.3)},command:{Tag:"use-toilet",Description:" Sit down and use the toilet.",Action:()=>{N.activity.Criteria(Player)||ln("You try to use the toilet but you can't seem to get anything out."),N.activity.Criteria(Player)&&I()}}},T="Normal",O={Deny:"Deny",Ask:"Ask",Allow:"Allow"},_={Disabled:0,Slow:.5,Normal:1,Fast:1.5,Faster:2,Fastest:3};var F;!function(e){e[e.Anyone=0]="Anyone",e[e.ItemPermission=1]="ItemPermission",e[e.Friends=2]="Friends",e[e.Lovers=3]="Lovers",e[e.Owner=5]="Owner",e[e.Self=6]="Self"}(F||(F={}));var z="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,R=z||$||Function("return this")(),j=R.Symbol,V=Object.prototype,G=V.hasOwnProperty,H=V.toString,W=j?j.toStringTag:void 0;var Y=Object.prototype.toString;var U="[object Null]",q="[object Undefined]",X=j?j.toStringTag:void 0;function K(e){return null==e?void 0===e?q:U:X&&X in Object(e)?function(e){var t=G.call(e,W),n=e[W];try{e[W]=void 0;var o=!0}catch(e){}var r=H.call(e);return o&&(t?e[W]=n:delete e[W]),r}(e):function(e){return Y.call(e)}(e)}function J(e){return null!=e&&"object"==typeof e}var Z="[object Symbol]";var Q=Array.isArray,ee=/\s/;var te=/^\s+/;function ne(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&ee.test(e.charAt(t)););return t}(e)+1).replace(te,""):e}function oe(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var re=NaN,se=/^[-+]0x[0-9a-f]+$/i,ae=/^0b[01]+$/i,ie=/^0o[0-7]+$/i,le=parseInt;function ce(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||J(e)&&K(e)==Z}(e))return re;if(oe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=oe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=ne(e);var n=ae.test(e);return n||ie.test(e)?le(e.slice(2),n?2:8):se.test(e)?re:+e}function de(e){return e}var ue="[object AsyncFunction]",pe="[object Function]",he="[object GeneratorFunction]",me="[object Proxy]";function ge(e){if(!oe(e))return!1;var t=K(e);return t==pe||t==he||t==ue||t==me}var fe,be=R["__core-js_shared__"],ye=(fe=/[^.]+$/.exec(be&&be.keys&&be.keys.IE_PROTO||""))?"Symbol(src)_1."+fe:"";var ve=Function.prototype.toString;var Ce=/^\[object .+?Constructor\]$/,Ae=Function.prototype,Se=Object.prototype,we=Ae.toString,Me=Se.hasOwnProperty,Pe=RegExp("^"+we.call(Me).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Be(e){return!(!oe(e)||(t=e,ye&&ye in t))&&(ge(e)?Pe:Ce).test(function(e){if(null!=e){try{return ve.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t}function Le(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Be(n)?n:void 0}var xe=Object.create,De=function(){function e(){}return function(t){if(!oe(t))return{};if(xe)return xe(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var ke=Date.now;var Ee,Ie,Ne,Te=function(){try{var e=Le(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Oe=Te?function(e,t){return Te(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:de,_e=(Ee=Oe,Ie=0,Ne=0,function(){var e=ke(),t=16-(e-Ne);if(Ne=e,t>0){if(++Ie>=800)return arguments[0]}else Ie=0;return Ee.apply(void 0,arguments)}),Fe=9007199254740991,ze=/^(?:0|[1-9]\d*)$/;function $e(e,t){var n=typeof e;return!!(t=null==t?Fe:t)&&("number"==n||"symbol"!=n&&ze.test(e))&&e>-1&&e%1==0&&e<t}function Re(e,t,n){"__proto__"==t&&Te?Te(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function je(e,t){return e===t||e!=e&&t!=t}var Ve=Object.prototype.hasOwnProperty;function Ge(e,t,n){var o=e[t];Ve.call(e,t)&&je(o,n)&&(void 0!==n||t in e)||Re(e,t,n)}var He=Math.max;function We(e,t){return _e(function(e,t,n){return t=He(void 0===t?e.length-1:t,0),function(){for(var o=arguments,r=-1,s=He(o.length-t,0),a=Array(s);++r<s;)a[r]=o[t+r];r=-1;for(var i=Array(t+1);++r<t;)i[r]=o[r];return i[t]=n(a),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,i)}}(e,t,de),e+"")}var Ye=9007199254740991;function Ue(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Ye}function qe(e){return null!=e&&Ue(e.length)&&!ge(e)}var Xe=Object.prototype;function Ke(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Xe)}function Je(e){return J(e)&&"[object Arguments]"==K(e)}var Ze=Object.prototype,Qe=Ze.hasOwnProperty,et=Ze.propertyIsEnumerable,tt=Je(function(){return arguments}())?Je:function(e){return J(e)&&Qe.call(e,"callee")&&!et.call(e,"callee")},nt=tt;var ot="object"==typeof exports&&exports&&!exports.nodeType&&exports,rt=ot&&"object"==typeof module&&module&&!module.nodeType&&module,st=rt&&rt.exports===ot?R.Buffer:void 0,at=(st?st.isBuffer:void 0)||function(){return!1},it={};it["[object Float32Array]"]=it["[object Float64Array]"]=it["[object Int8Array]"]=it["[object Int16Array]"]=it["[object Int32Array]"]=it["[object Uint8Array]"]=it["[object Uint8ClampedArray]"]=it["[object Uint16Array]"]=it["[object Uint32Array]"]=!0,it["[object Arguments]"]=it["[object Array]"]=it["[object ArrayBuffer]"]=it["[object Boolean]"]=it["[object DataView]"]=it["[object Date]"]=it["[object Error]"]=it["[object Function]"]=it["[object Map]"]=it["[object Number]"]=it["[object Object]"]=it["[object RegExp]"]=it["[object Set]"]=it["[object String]"]=it["[object WeakMap]"]=!1;var lt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ct=lt&&"object"==typeof module&&module&&!module.nodeType&&module,dt=ct&&ct.exports===lt&&z.process,ut=function(){try{var e=ct&&ct.require&&ct.require("util").types;return e||dt&&dt.binding&&dt.binding("util")}catch(e){}}(),pt=ut&&ut.isTypedArray,ht=pt?function(e){return function(t){return e(t)}}(pt):function(e){return J(e)&&Ue(e.length)&&!!it[K(e)]},mt=Object.prototype.hasOwnProperty;function gt(e,t){var n=Q(e),o=!n&&nt(e),r=!n&&!o&&at(e),s=!n&&!o&&!r&&ht(e),a=n||o||r||s,i=a?function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o}(e.length,String):[],l=i.length;for(var c in e)!t&&!mt.call(e,c)||a&&("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||$e(c,l))||i.push(c);return i}var ft=Object.prototype.hasOwnProperty;function bt(e){if(!oe(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=Ke(e),n=[];for(var o in e)("constructor"!=o||!t&&ft.call(e,o))&&n.push(o);return n}function yt(e){return qe(e)?gt(e,!0):bt(e)}var vt=Le(Object,"create");var Ct=Object.prototype.hasOwnProperty;var At=Object.prototype.hasOwnProperty;function St(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}function wt(e,t){for(var n=e.length;n--;)if(je(e[n][0],t))return n;return-1}St.prototype.clear=function(){this.__data__=vt?vt(null):{},this.size=0},St.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},St.prototype.get=function(e){var t=this.__data__;if(vt){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ct.call(t,e)?t[e]:void 0},St.prototype.has=function(e){var t=this.__data__;return vt?void 0!==t[e]:At.call(t,e)},St.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=vt&&void 0===t?"__lodash_hash_undefined__":t,this};var Mt=Array.prototype.splice;function Pt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Pt.prototype.clear=function(){this.__data__=[],this.size=0},Pt.prototype.delete=function(e){var t=this.__data__,n=wt(t,e);return!(n<0)&&(n==t.length-1?t.pop():Mt.call(t,n,1),--this.size,!0)},Pt.prototype.get=function(e){var t=this.__data__,n=wt(t,e);return n<0?void 0:t[n][1]},Pt.prototype.has=function(e){return wt(this.__data__,e)>-1},Pt.prototype.set=function(e,t){var n=this.__data__,o=wt(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this};var Bt=Le(R,"Map");function Lt(e,t){var n,o,r=e.__data__;return("string"==(o=typeof(n=t))||"number"==o||"symbol"==o||"boolean"==o?"__proto__"!==n:null===n)?r["string"==typeof t?"string":"hash"]:r.map}function xt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}xt.prototype.clear=function(){this.size=0,this.__data__={hash:new St,map:new(Bt||Pt),string:new St}},xt.prototype.delete=function(e){var t=Lt(this,e).delete(e);return this.size-=t?1:0,t},xt.prototype.get=function(e){return Lt(this,e).get(e)},xt.prototype.has=function(e){return Lt(this,e).has(e)},xt.prototype.set=function(e,t){var n=Lt(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};var Dt=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object),kt="[object Object]",Et=Function.prototype,It=Object.prototype,Nt=Et.toString,Tt=It.hasOwnProperty,Ot=Nt.call(Object);function _t(e){var t=this.__data__=new Pt(e);this.size=t.size}_t.prototype.clear=function(){this.__data__=new Pt,this.size=0},_t.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},_t.prototype.get=function(e){return this.__data__.get(e)},_t.prototype.has=function(e){return this.__data__.has(e)},_t.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Pt){var o=n.__data__;if(!Bt||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new xt(o)}return n.set(e,t),this.size=n.size,this};var Ft="object"==typeof exports&&exports&&!exports.nodeType&&exports,zt=Ft&&"object"==typeof module&&module&&!module.nodeType&&module,$t=zt&&zt.exports===Ft?R.Buffer:void 0,Rt=$t?$t.allocUnsafe:void 0;var jt=R.Uint8Array;function Vt(e,t){var n,o,r=t?(n=e.buffer,o=new n.constructor(n.byteLength),new jt(o).set(new jt(n)),o):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Gt,Ht=function(e,t,n){for(var o=-1,r=Object(e),s=n(e),a=s.length;a--;){var i=s[Gt?a:++o];if(!1===t(r[i],i,r))break}return e},Wt=function(){return R.Date.now()},Yt=Math.max,Ut=Math.min;function qt(e,t,n){(void 0!==n&&!je(e[t],n)||void 0===n&&!(t in e))&&Re(e,t,n)}function Xt(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function Kt(e){return function(e,t,n,o){var r=!n;n||(n={});for(var s=-1,a=t.length;++s<a;){var i=t[s],l=o?o(n[i],e[i],i,n,e):void 0;void 0===l&&(l=e[i]),r?Re(n,i,l):Ge(n,i,l)}return n}(e,yt(e))}function Jt(e,t,n,o,r,s,a){var i=Xt(e,n),l=Xt(t,n),c=a.get(l);if(c)qt(e,n,c);else{var d,u=s?s(i,l,n+"",e,t,a):void 0,p=void 0===u;if(p){var h=Q(l),m=!h&&at(l),g=!h&&!m&&ht(l);u=l,h||m||g?Q(i)?u=i:J(d=i)&&qe(d)?u=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t}(i):m?(p=!1,u=function(e,t){if(t)return e.slice();var n=e.length,o=Rt?Rt(n):new e.constructor(n);return e.copy(o),o}(l,!0)):g?(p=!1,u=Vt(l,!0)):u=[]:function(e){if(!J(e)||K(e)!=kt)return!1;var t=Dt(e);if(null===t)return!0;var n=Tt.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Nt.call(n)==Ot}(l)||nt(l)?(u=i,nt(i)?u=Kt(i):oe(i)&&!ge(i)||(u=function(e){return"function"!=typeof e.constructor||Ke(e)?{}:De(Dt(e))}(l))):p=!1}p&&(a.set(l,u),r(u,l,o,s,a),a.delete(l)),qt(e,n,u)}}function Zt(e,t,n,o,r){e!==t&&Ht(t,(function(s,a){if(r||(r=new _t),oe(s))Jt(e,t,a,n,Zt,o,r);else{var i=o?o(Xt(e,a),s,a+"",e,t,r):void 0;void 0===i&&(i=s),qt(e,a,i)}}),yt)}var Qt,en=(Qt=function(e,t,n){Zt(e,t,n)},We((function(e,t){var n=-1,o=t.length,r=o>1?t[o-1]:void 0,s=o>2?t[2]:void 0;for(r=Qt.length>3&&"function"==typeof r?(o--,r):void 0,s&&function(e,t,n){if(!oe(n))return!1;var o=typeof t;return!!("number"==o?qe(n)&&$e(t,n.length):"string"==o&&t in n)&&je(n[t],e)}(t[0],t[1],s)&&(r=o<3?void 0:r,o=1),e=Object(e);++n<o;){var a=t[n];a&&Qt(e,a,n,r)}return e})));const tn={PeeMetabolism:T,PoopMetabolism:T,OpenRemoteSettings:!1,LockedOutOfSettings:!1,DisableWettingLeaks:!1,DisableSoilingLeaks:!0,OnDiaperChange:O.Ask},nn={PuddleSize:{value:0},Bladder:{value:0,size:300},Bowel:{value:0,size:200},Soiliness:{value:0},Wetness:{value:0},WaterIntake:{value:15},FoodIntake:{value:200/60},Incontinence:{value:0},MentalRegression:{value:0}},on={Settings:tn,Stats:nn},rn=function(e,t,n){var o,r,s,a,i,l,c=0,d=!1,u=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=o,s=r;return o=r=void 0,c=t,a=e.apply(s,n)}function m(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-c>=s}function g(){var e=Wt();if(m(e))return f(e);i=setTimeout(g,function(e){var n=t-(e-l);return u?Ut(n,s-(e-c)):n}(e))}function f(e){return i=void 0,p&&o?h(e):(o=r=void 0,a)}function b(){var e=Wt(),n=m(e);if(o=arguments,r=this,l=e,n){if(void 0===i)return function(e){return c=e,i=setTimeout(g,t),d?h(e):a}(l);if(u)return clearTimeout(i),i=setTimeout(g,t),h(l)}return void 0===i&&(i=setTimeout(g,t)),a}return t=ce(t)||0,oe(n)&&(d=!!n.leading,s=(u="maxWait"in n)?Yt(ce(n.maxWait)||0,t):s,p="trailing"in n?!!n.trailing:p),b.cancel=function(){void 0!==i&&clearTimeout(i),c=0,o=l=r=i=void 0},b.flush=function(){return void 0===i?a:f(Wt())},b}((()=>{const e=LZString.compressToBase64(JSON.stringify(Player.ABCL));Player.ExtensionSettings.ABCL=e,ServerPlayerExtensionSettingsSync("ABCL"),Gn()}),1e3),sn=n.registerMod({name:a,fullName:a,version:s,repository:"https://github.com/zoe-64/ABCL"});var an;!function(e){e[e.OBSERVE=0]="OBSERVE",e[e.ADD_BEHAVIOR=1]="ADD_BEHAVIOR",e[e.MODIFY_BEHAVIOR=5]="MODIFY_BEHAVIOR",e[e.OVERRIDE_BEHAVIOR=10]="OVERRIDE_BEHAVIOR",e[e.TOP=100]="TOP"}(an||(an={}));const ln=e=>{if(!ServerPlayerIsInChatRoom())return;const t=document.createElement("div");t.innerHTML=e.split("\n").map((e=>e.trim())).join("<br/>"),t.classList.add("ABCLLocalMessage"),document.querySelector("#TextAreaChatLog")?.appendChild(t),ElementScrollToEnd("TextAreaChatLog")};const cn=async(e,t={})=>new Promise(((n,o)=>{const r=document.querySelector(e);if(r)return void n(r);const s=new MutationObserver((()=>{const o=document.querySelector(e);o&&(!t.childCheck||o.childElementCount>0)&&(s.disconnect(),clearTimeout(a),n(o))}));s.observe(document.body,{childList:!0,subtree:!0});const a=setTimeout((()=>{s.disconnect(),console.warn(`Element with selector "${e}" not found within timeout`)}),t.timeout||1e4)})),dn=e=>`${e=e||"ABCL"}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const un=e=>"Default"!==e&&"string"==typeof e,pn=(e,t)=>("string"==typeof e&&"Default"!==e&&o.warn(`Unknown color: ${e}`),e&&"Default"!==e?Array.isArray(e)?e.map((e=>"Default"===e?"#FFFFFF":e)):[e]:[...t.DefaultColor.map((e=>"Default"===e?"#FFFFFF":e))]),hn=()=>{CharacterRefresh(Player,!0),ChatRoomCharacterUpdate(Player)},mn={onAccident:()=>{mn.stats.MentalRegression+=In()},update:()=>{mn.stats.MentalRegression+=kn(),mn.stats.BladderValue+=mn.stats.WaterIntake*_[mn.settings.PeeMetabolism],mn.stats.BowelValue+=mn.stats.FoodIntake*_[mn.settings.PoopMetabolism],"Disabled"!==mn.settings.PeeMetabolism&&mn.attemptWetting(),"Disabled"!==mn.settings.PoopMetabolism&&mn.attemptSoiling(),gn.save()},wetClothing:()=>{ln("You've had a wet accident in your clothes!"),mn.stats.PuddleSize+=mn.stats.BladderValue,mn.stats.BladderValue=0;const e="#96936C",t=InventoryGet(Player,"Panties");if(t){const n=pn(t.Color||t.Asset.DefaultColor,t.Asset);for(let t=0;t<n.length;t++)un(n[t])&&(n[t]=An(n[t],e,.3));t.Color=n}for(const t of Player.Appearance)if(r.ItemDefinitions.Pants.some((e=>e===t.Asset.Description))){const n=pn(t.Color||t.Asset.DefaultColor,t.Asset);for(let t=0;t<n.length;t++)un(n[t])&&(n[t]=An(n[t],e,.3));t.Color=n}mn.stats.PuddleSize+=mn.stats.BladderValue,mn.stats.BladderFullness=0,Cn()?p("%NAME%'s diaper leaks and wet %INTENSIVE% clothes causing a puddle to form."):p("%NAME%'s wets %INTENSIVE% clothes leaks onto the floor."),hn(),Gn()},soilClothing:()=>{mn.stats.PuddleSize+=mn.stats.BladderValue,mn.stats.BladderValue=0;const e=InventoryGet(Player,"Panties");if(e){const t=pn(e.Color||e.Asset.DefaultColor,e.Asset);for(let e=0;e<t.length;e++)un(t[e])&&(t[e]=An(t[e],"#261a16",.3));e.Color=t}Cn()?p("%NAME%'s diaper leaks and soils %INTENSIVE% clothes and the floor."):p("%NAME% soils %INTENSIVE% clothes and the floor."),hn()},wetDiaper:()=>{const e=Pn(),t=Math.min(mn.stats.BladderValue,e-mn.stats.WetnessValue);p("%NAME% wets %INTENSIVE% diaper."),mn.stats.BladderValue-=t,mn.stats.WetnessValue+=t,mn.stats.WetnessValue>=e&&mn.wetClothing()},soilDiaper:()=>{const e=Pn(),t=Math.min(mn.stats.BowelValue,Math.max(0,e-mn.stats.SoilinessValue));p("%NAME% soils %INTENSIVE% diaper."),mn.stats.BowelValue-=t,mn.stats.SoilinessValue+=t,mn.stats.SoilinessValue>0&&mn.soilClothing()},attemptWetting:()=>{const e=Ln(mn.stats.Incontinence),t=xn(mn.stats.Incontinence,mn.stats.BladderFullness);(Math.random()<t||mn.stats.BladderFullness>e)&&fn.check()&&MiniGameStart("WetMinigame",30*t,"noOp")},attemptSoiling:()=>{const e=Ln(mn.stats.Incontinence),t=xn(mn.stats.Incontinence,mn.stats.BowelFullness);(Math.random()<t||mn.stats.BowelFullness>e)&&fn.check()&&MiniGameStart("MessMinigame",30*t,"noOp")},wet:(e=!1)=>{const t=mn.stats.BladderFullness<.3,n=!t,o=mn.stats.BladderFullness>.6;t?ln("You try to pee, but it doesn't seem to be working."):(n&&(Cn()?mn.wetDiaper():mn.wetClothing()),o&&e?mn.stats.Incontinence-=.01:mn.stats.Incontinence+=.02)},soil:(e=!1)=>{const t=mn.stats.BowelFullness<.3,n=!t,o=mn.stats.BowelFullness>.6;t?ln("You try to let go, but nothing seems to happen."):(n&&(Cn()?mn.soilDiaper():mn.soilClothing()),o&&e?mn.stats.Incontinence-=.01:mn.stats.Incontinence+=.02)},stats:{set PuddleSize(e){e<0&&(e=0),e>250&&(e=250),Player.ABCL.Stats.PuddleSize.value=e},get PuddleSize(){return Player.ABCL.Stats.PuddleSize.value},set MentalRegression(e){e<0&&(e=0),e>1&&(e=1),Player.ABCL.Stats.MentalRegression.value=e,C.update()},get MentalRegression(){return Player.ABCL.Stats.MentalRegression.value},set Incontinence(e){e<0&&(e=0),e>1&&(e=1),Player.ABCL.Stats.Incontinence.value=e,C.update()},get Incontinence(){return Player.ABCL.Stats.Incontinence.value},set WaterIntake(e){e<0&&(e=0),Player.ABCL.Stats.WaterIntake.value=e},get WaterIntake(){return Player.ABCL.Stats.WaterIntake.value},set FoodIntake(e){e<0&&(e=0),Player.ABCL.Stats.FoodIntake.value=e},get FoodIntake(){return Player.ABCL.Stats.FoodIntake.value},set BladderValue(e){e<0&&(e=0),Player.ABCL.Stats.Bladder.value=e,C.update()},get BladderValue(){return Player.ABCL.Stats.Bladder.value},set BladderSize(e){e<0&&(e=0),Player.ABCL.Stats.Bladder.size=e,C.update()},get BladderSize(){return Player.ABCL.Stats.Bladder.size},set WetnessValue(e){e<0&&(e=0),Player.ABCL.Stats.Wetness.value=e,Mn(),C.update()},get WetnessValue(){return Player.ABCL.Stats.Wetness.value},set BladderFullness(e){e<0&&(e=0),this.BladderValue=e*this.BladderSize,C.update()},get BladderFullness(){return this.BladderValue/this.BladderSize},set BowelValue(e){e<0&&(e=0),Player.ABCL.Stats.Bowel.value=e,C.update()},get BowelValue(){return Player.ABCL.Stats.Bowel.value},set BowelSize(e){e<0&&(e=0),Player.ABCL.Stats.Bowel.size=e,C.update()},get BowelSize(){return Player.ABCL.Stats.Bowel.size},set SoilinessValue(e){e<0&&(e=0),Player.ABCL.Stats.Soiliness.value=e,Mn(),C.update()},get SoilinessValue(){return Player.ABCL.Stats.Soiliness.value},set BowelFullness(e){e<0&&(e=0),this.BowelValue=e*this.BowelSize,C.update()},get BowelFullness(){return this.BowelValue/this.BowelSize},get SoilinessPercentage(){return 0==Pn()?0:this.SoilinessValue/Pn()},set SoilinessPercentage(e){e<0&&(e=0),this.SoilinessValue=e*Pn()},get WetnessPercentage(){return 0==Pn()?0:this.WetnessValue/Pn()},set WetnessPercentage(e){e<0&&(e=0),this.WetnessValue=e*Pn()}},settings:{set PeeMetabolism(e){Player.ABCL.Settings.PeeMetabolism=e},set PoopMetabolism(e){Player.ABCL.Settings.PoopMetabolism=e},get PeeMetabolism(){return Player.ABCL.Settings.PeeMetabolism},get PoopMetabolism(){return Player.ABCL.Settings.PoopMetabolism},get OnDiaperChange(){return Player.ABCL.Settings.OnDiaperChange},set OnDiaperChange(e){Player.ABCL.Settings.OnDiaperChange=e},set OpenRemoteSettings(e){Player.ABCL.Settings.OpenRemoteSettings=e},get OpenRemoteSettings(){return Player.ABCL.Settings.OpenRemoteSettings}}},gn=new class{constructor(e){this.lastSaveTime=0,this.allowedSaveInterval=e}save(){Date.now()-this.lastSaveTime>this.allowedSaveInterval&&(rn(),this.lastSaveTime=Date.now())}}(12e4),fn=new class{constructor(e){this.lastCallTime=0,this.allowedCallInterval=e}check(){return Date.now()-this.lastCallTime>this.allowedCallInterval&&(this.lastCallTime=Date.now(),!0)}reset(){this.lastCallTime=0}isReady(){return Date.now()-this.lastCallTime>this.allowedCallInterval}}(12e4);window.abclPlayer=mn;const bn=(e="any")=>{const t=Pn();return"pee"===e?mn.stats.PuddleSize>0:"poop"===e?mn.stats.SoilinessValue>=t:mn.stats.SoilinessValue>=t||mn.stats.WetnessValue>=t},yn=()=>{const e=Pn();return mn.stats.SoilinessValue+mn.stats.WetnessValue>=e/2},vn=e=>e.Asset.Description.toLowerCase().includes("diaper")&&e.Asset.Description in r.Diapers;function Cn(e=Player){if(!e)return!1;const t=InventoryGet(e,"ItemPelvis"),n=InventoryGet(e,"Panties");return Boolean(t&&vn(t)||n&&vn(n))}function An(e,t,n=.5){let o=DrawHexToRGB(e),r=DrawHexToRGB(t),s={r:Math.round(o.r*n+r.r*(1-n)),g:Math.round(o.g*n+r.g*(1-n)),b:Math.round(o.b*n+r.b*(1-n))};return DrawRGBToHex([s.r,s.g,s.b])}function Sn(e,t,n,o){return e>.75?e>.9?t:An(t,n,e-.75):An(n,o,e)}const wn=(e,t,n,o=Player)=>{const s=InventoryGet(o,e);if(s&&vn(s)){const e=typeof s.Asset.DefaultColor,o=r.Diapers[s.Asset.Description];e!==typeof s.Color&&(s.Color=s.Asset.DefaultColor),"object"===e&&JSON.stringify(s.Color).includes('"Default"')&&(s.Color=JSON.parse(JSON.stringify(s.Color).replaceAll(/"Default"/g,'"#FFFFFF"')));const a=s.Color??s.Asset.DefaultColor;"primaryColor"in o&&(a[o.primaryColor]=t),"secondaryColor"in o&&(a[o.secondaryColor]=n),s.Color=a}},Mn=()=>{const e=mn.stats.SoilinessValue/Pn(),t=mn.stats.WetnessValue/Pn(),n=Sn(e,r.DiaperColors.maximummess,r.DiaperColors.middlemess,r.DiaperColors.clean),o=Sn(t,r.DiaperColors.maximumwet,r.DiaperColors.middlewet,r.DiaperColors.clean),s=An(n,o,.7),a=An(n,o,.9);wn("ItemPelvis",s,a,Player),wn("Panties",s,a,Player),hn()};function Pn(e=Player){const t=InventoryGet(e,"ItemPelvis"),n=InventoryGet(e,"Panties");let o=0;return t&&vn(t)&&(o+=Bn(t)),n&&vn(n)&&(o+=Bn(n)),o}function Bn(e){return"Poofy Chastity Diaper"===e.Asset.Description&&1===e.Property?.TypeRecord?.typed?r.DiaperSizeScale.heavy_adult:r.DiaperSizeScale[r.Diapers[e.Asset.Description].size]}const Ln=e=>.9-.5*e;function xn(e,t){const n=.6*Math.pow(e,2)+.8*Math.pow(t,3);return Math.min(Math.max(n,0),1)}const Dn=()=>{const e=Player.Appearance.map((e=>e.Asset.Description)),t=r.ItemDefinitions.BabyItems.concat(["milk","pacifier","bib"]).filter((t=>e.some((e=>e.toLocaleLowerCase().includes(t)))));return Math.min(.25*t.length,1)},kn=()=>{let e=0+Dn();return Player.Appearance.some((e=>r.ItemDefinitions.BabyItems.includes(e.Asset.Description)))&&(e+=1),yn()&&(e+=.25),bn()&&(e+=.5),e/9e3};function En(){const e=[{totalAccidents:60,start:0,end:.25},{totalAccidents:120,start:.25,end:.5},{totalAccidents:240,start:.5,end:.75},{totalAccidents:480,start:.75,end:1}];for(const{totalAccidents:t,start:n,end:o}of e)if(mn.stats.Incontinence>=n&&mn.stats.Incontinence<o)return.25/t;return 0}const In=()=>{const e=1+Dn();return mn.stats.MentalRegression<.25||.25>mn.stats.MentalRegression&&mn.stats.MentalRegression<.5&&yn()?e/500:.5>mn.stats.MentalRegression&&mn.stats.MentalRegression<.75&&bn()?e/1e3:.75>mn.stats.MentalRegression&&mn.stats.MentalRegression<1&&bn()?e/1500:0},Nn=e=>{e.MemberNumber===Player.MemberNumber?Tn(Player):Vn("lick-puddle",void 0,e.MemberNumber)},Tn=e=>{e.MemberNumber!==Player.MemberNumber?p(u("%OPP_NAME% licks %NAME%'s puddle of pee.",e)):p(u("%NAME% licks %INTENSIVE% puddle of pee.",e)),mn.stats.PuddleSize-=50,Gn(),hn()},On={activity:{ID:"lick-puddle",Name:"Lick Puddle",Image:"https://zoe-64.github.io/ABCL/beta/assets/activity/lickPuddle.png",OnClick:(e,t)=>Nn(e),Target:["ItemBoots"],Criteria:e=>c(e)&&e.ABCL.Stats.PuddleSize.value>0},command:{Tag:"lick-puddle",Description:" [MemberNumber|Name|Nickname]: Licks a puddle of pee.",Action:(e,t,n)=>{const o=l(n[0]);o?(On.activity.Criteria(o)||ln("Is either not an ABCL player or has no puddle."),Nn(o)):ln(`Could not find character: "${n[0]}"`)}},listeners:{"lick-puddle":({Sender:e})=>{Tn(l(e)??Player)}}},_n=e=>{e.MemberNumber===Player.MemberNumber?Fn(Player):Vn("wipe-puddle",void 0,e.MemberNumber)},Fn=e=>{e.MemberNumber!==Player.MemberNumber?p(u("%OPP_NAME% wipes %NAME%'s puddle of pee.",e)):p(u("%NAME% wipes %INTENSIVE% puddle of pee.",e)),mn.stats.PuddleSize=0,Gn(),hn()},zn={activity:{ID:"wipe-puddle",Name:"Wipe Puddle",Image:"./Assets/Female3DCG/ItemHandheld/Preview/Towel.png",OnClick:(e,t)=>{_n(e)},Target:["ItemBoots"],Criteria:e=>c(e)&&e.ABCL.Stats.PuddleSize.value>0},command:{Tag:"wipe-puddle",Description:" [MemberNumber|Name|Nickname]: Wipes a puddle of pee.",Action:(e,t,n)=>{const o=l(n[0]);o?(zn.activity.Criteria(o)||ln("Is either not an ABCL player or has no puddle."),_n(o)):ln(`Could not find character: "${n[0]}"`)}},listeners:{"wipe-puddle":({Sender:e})=>{Fn(l(e)??Player)}}};class $n{constructor(e,t,n,o,r,s,a){this.id=e,this.name=t,this.image=n,this.onClick=o,this.target=r,this.targetSelf=s,this.criteria=a}fitsCriteria(e,t){return Boolean((!this.criteria||this.criteria(e))&&(this.target?.includes(t)||this.targetSelf?.includes(t)&&Player.MemberNumber===e?.MemberNumber))}createButton(){const e=document.createElement("button");return e.id=this.id,e.name=`ABCL_${this.name}`,e.dataset.group="ItemArms",e.className="blank-button button button-styling HideOnPopup dialog-grid-button",e.innerHTML=`<img decoding="async" loading="lazy" src="${this.image}" class="button-image"><span class="button-label button-label-bottom">${this.name}</span>`,e.addEventListener("click",(e=>{const t=CurrentCharacter?.FocusGroup?CurrentCharacter:Player,n=t?.FocusGroup?.Name;this.onClick&&n&&(this.onClick(t,n),DialogLeave())})),e}static isInserted(e){return Boolean(document.getElementById(e))}}const Rn=[M,B,x,D,E,N,L,On,zn],jn=Rn.reduce(((e,{command:t})=>t?[...e,t]:e),[]);Rn.reduce(((e,{activity:t})=>t?[...e,t]:e),[]);const Vn=(e,t,n)=>{const o={Type:"Hidden",Content:`${i}Msg`,Sender:Player.MemberNumber,Target:n,Dictionary:[{type:e,data:t}]};ServerSend("ChatRoomChat",o),console.log("sendDataToAction",e,t,n)},Gn=e=>{console.log("sendUpdateMyData target",e),Vn("sync",{settings:Player[i].Settings,stats:Player[i].Stats,version:s},e),o.debug({message:`Sending updated data to ${e??"everyone"}`})},Hn=()=>{Vn("init",1),o.debug("Requesting data from others.")},Wn=async()=>{await async function(e,t=(()=>!1)){for(;!e();){if(t())return!1;await new Promise((e=>setTimeout(e,10)))}return!0}((()=>ServerSocket&&ServerIsConnected)),sn.hookFunction("DrawCharacter",1,((e,t)=>{const[n,o,r,s]=e;if(c(n)&&n.ABCL.Stats.PuddleSize.value>0){const e=n.ABCL.Stats.PuddleSize.value/300,t=512*e,a=235*e;DrawImageResize("https://zoe-64.github.io/ABCL/beta/assets/puddle.png",o+(250*s-t/2),r+(940*s-a/2),t,a)}return t(e)})),sn.hookFunction("ChatRoomSync",1,((e,t)=>(Gn(),t(e)))),sn.hookFunction("ChatRoomMessage",1,((e,t)=>{if("ServerEnter"!==e[0].Content||e[0].Sender!==Player.MemberNumber)return(e=>{if("ABCLMsg"!==e?.Content)return;if(!e.Sender||!e.Dictionary)return;if(e.Sender===Player.MemberNumber)return;if("Hidden"!==e.Type)return;if(!e.Dictionary[0]?.type)return;const t=e.Dictionary[0]?.type,n=e.Dictionary[0]?.data;for(const o of Rn){const r=o.listeners?.[t];r&&r(e,n)}console.log("receivePacket",t,n,e.Sender)})(e[0]),t(e);Hn()})),sn.hookFunction("CharacterAppearanceSetItem",1,((e,t)=>{let[n,o,r]=e;const s=t(e);return"ItemPelvis"===o&&r&&vn({Asset:r})&&Mn(),s})),sn.hookFunction("PreferenceSubscreenChatClick",1,((e,t)=>{if(MouseIn(1815,75,90,90)){const e=Player.ChatSettings?.ColorTheme??"Light";e.startsWith("Light")&&v&&!v.classList.contains("sl-theme-light")&&(v.classList.remove("sl-theme-dark"),v.classList.add("sl-theme-light"),v.style.color="black",o.info("SL theme switching: Light")),e.startsWith("Dark")&&v&&!v.classList.contains("sl-theme-dark")&&(v.classList.remove("sl-theme-light"),v.classList.add("sl-theme-dark"),v.style.color="white",o.info("SL theme switching: Dark"))}return t(e)}))},Yn=[];window.addEventListener("error",(async e=>{if(console.error(e.filename),!e.filename.toLowerCase().includes("abcl"))return;const t=`${e.message} at ${e.filename} ${e.lineno}`;if(Yn.includes(t))return;Yn.push(t);const o={username:`${Player.Name} ${""===Player.Nickname?"":`aka ${Player.Nickname}`} (${Player.MemberNumber})`,thread_name:`${i} ${s} Error ${e.message}`.slice(0,100),content:`\n    error: ${t}\n\`\`\`\n${e.error.stack}\n\`\`\`\nmods: ${n.getModsInfo().map((e=>e.name)).join(", ")}`};await fetch("https://discord.com/api/webhooks/1340000414506029162/aqt7qruFnzDMM5BN_kLtv9gCcallIF-JeRVYl9k23uSIlxrHRvcFMy5mtPUPGDpWZhHX",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}));const Un=document.createElement("div");Un.classList.add("ABCLSettingPage","ABCLHidden");sn.hookFunction("TextLoad",5,((e,t)=>"WetMinigame"===CurrentScreen||"MessMinigame"===CurrentScreen?void 0:t(e)));function qn(e){var t=e.name;console.log("Registering minigame: "+t),window[t+"Run"]=()=>e.Run(),window[t+"Click"]=()=>e.Click(),window[t+"Load"]=()=>e.Load(),window[t+"Unload"]=()=>e.Unload(),window[t+"Resize"]=()=>e.Resize(),window[t+"KeyDown"]=()=>e.KeyDown(),window[t+"Exit"]=()=>e.Exit(),window[t+"End"]=t=>e.End(t)}class Xn{constructor(){this.name=""}Load(){}Unload(){}Resize(){}KeyDown(){}Exit(){}End(e){}}class Kn extends Xn{constructor(){super(...arguments),this.startText="",this.hintText="",this.failText="",this.successText="",this.tintColor=[{r:0,g:0,b:0,a:0}],this.GameStartTime=0,this.GameEndTime=0,this.StartDelay=4e3,this.AccidentVelocity=0,this.AccidentPosition=0,this.AccidentAcceleration=0,this.AccidentMaxPosition=100,this.AccidentGameDuration=5e3,this.AccidentNextTick=0,this.AccidentText="",this.AccidentChallenge=0,this.BaseGameLength=6e3}End(e){CommonSetScreen("Online","ChatRoom"),MiniGameVictory=e,MiniGameEnded=!0,MiniGameTimer=CommonTime(),this.GameEndTime=MiniGameTimer}get IsStartDelay(){return CommonTime()<this.GameStartTime}Load(){if(DrawFlashScreen("#000000",750,1e3),this.GameStartTime=CommonTime()+this.StartDelay,this.AccidentVelocity=0,this.AccidentAcceleration=0,"number"!=typeof MiniGameDifficulty)MiniGameTimer=CommonTime()+this.BaseGameLength,this.AccidentChallenge=5;else{var e=.25*(MiniGameDifficulty-8);this.AccidentGameDuration=this.BaseGameLength+1e3*e,MiniGameTimer=this.GameStartTime+this.AccidentGameDuration,this.AccidentChallenge=MiniGameDifficulty}this.AccidentMaxPosition=400,this.AccidentPosition=this.AccidentMaxPosition,console.info("Accident minigame started: difficulty - "+this.AccidentChallenge+" time - "+this.AccidentGameDuration)}get IsGameActive(){return CommonTime()<MiniGameTimer&&!MiniGameEnded&&!this.GameFailed}get IsGameTimeout(){return CommonTime()>=MiniGameTimer&&!MiniGameEnded}get IsEndGameReport(){return CommonTime()<this.GameEndTime+5e3}get GameFailed(){return this.AccidentPosition<=0}RunGame(e){var t=(this.AccidentGameDuration+CommonTime()-MiniGameTimer)/1e3;CommonTime()>this.AccidentNextTick&&(this.AccidentNextTick=CommonTime()+400,this.AccidentAcceleration=-1.25*this.AccidentChallenge-t*Math.random()),this.AccidentVelocity=Math.min(this.AccidentVelocity,this.AccidentVelocity+.25*this.AccidentAcceleration),this.AccidentPosition>=this.AccidentMaxPosition&&(this.AccidentVelocity=Math.min(0,this.AccidentVelocity)),this.AccidentPosition>0&&(this.AccidentPosition+=this.AccidentVelocity/1e3*e*3.5),this.AccidentPosition=Math.max(0,Math.min(this.AccidentPosition,this.AccidentMaxPosition)),DrawProgressBar(500-this.AccidentMaxPosition,800,2*this.AccidentMaxPosition,50,this.AccidentPosition/this.AccidentMaxPosition*100),DrawText(this.hintText,500,875,"white","black")}Run(){ChatRoomRun(CommonTime()),this.IsStartDelay?DrawText(this.startText,500,500,"white","black"):this.IsGameActive?this.RunGame(TimerRunInterval):!this.IsGameTimeout&&!this.GameFailed||MiniGameEnded||(this.End(this.AccidentPosition>0),MiniGameEnd())}Click(){var e;this.IsGameActive&&(this.AccidentVelocity=Math.max(this.AccidentVelocity+(e=11,Math.floor(Math.random()*e)+5),20))}}class Jn extends Kn{constructor(){super(...arguments),this.startText="A sudden pressure builds within you...",this.hintText="Click to maintain control. Keep it together!",this.failText="Oops! You've had an accident!",this.successText="Crisis averted! You stayed composed!",this.name="MessMinigame"}End(e){if(super.End(e),e)return mn.stats.Incontinence-=En()/2,void ln("You managed to keep it together!");mn.soil(),mn.onAccident()}}class Zn extends Kn{constructor(){super(...arguments),this.startText="You feel a trickle starting...",this.hintText="Click to squeeze tight. Don't let it get away!",this.failText="Oh no! You lost control!",this.successText="You held it in! Phew!",this.name="WetMinigame"}End(e){if(super.End(e),e)return mn.stats.Incontinence-=En()/2,void ln("You managed to hold it in!");mn.wet(),mn.onAccident()}}window.clearData=()=>{Player.ExtensionSettings.ABCL="N4XyA===",ServerPlayerExtensionSettingsSync("ABCL"),o.warn("cleared data")},window.saveData=rn,window.mutateData=e=>{Player.ABCL=en(Player.ABCL||on,e),rn()},window.noOp=()=>{},window.averageColor=An,console.log(An("#ffffff","#928f67",.99));const Qn=async()=>{var e;(async()=>{const e=LZString.decompressFromBase64(Player.ExtensionSettings.ABCL),t=e?JSON.parse(e):{Settings:{},Stats:{}};if("2.0.0"===t.ModVersion){const e=t.Settings.Metabolism,n=t.Settings.DisableWetting;t.Settings={...Object.fromEntries(Object.entries(t.Settings).filter((([e])=>!["DisableWetting","DisableSoiling","Metabolism","CaregiverIDs"].includes(e))).map((([e,{value:t}])=>[e,t]))),PeeMetabolism:n?"Disabled":e,PoopMetabolism:n?"Disabled":e},t.ModVersion=void 0,t.Version="2.0.1"}const n=en({Settings:tn,Stats:nn,Version:"2.0.1"},t);o.debug({message:"Merged settings object",modStorageObject:n}),Player.ABCL=n})(),(async()=>{Un.innerHTML=`<sl-tab-group>\n  <sl-tab slot="nav" panel="general">General</sl-tab>\n  <sl-tab slot="nav" panel="remote">Remote</sl-tab>\n  <sl-tab-panel name="general">\n    <sl-radio-group class="ABCLPeeMetabolismSelect" label="Select Pee Metabolism" name="pee-metabolism" value="${mn.settings.PeeMetabolism}">\n    <sl-radio-button value="Disabled">Disabled</sl-radio-button>\n    <sl-radio-button value="Slow">Slow</sl-radio-button>\n    <sl-radio-button value="Normal">Normal</sl-radio-button>\n    <sl-radio-button value="Fast">Fast</sl-radio-button>\n    <sl-radio-button value="Faster">Faster</sl-radio-button>\n    <sl-radio-button value="Fastest">Fastest</sl-radio-button>\n    </sl-radio-group>\n\n    <sl-radio-group class="ABCLPoopMetabolismSelect" label="Select Poop Metabolism" name="poop-metabolism" value="${mn.settings.PoopMetabolism}">\n    <sl-radio-button value="Disabled">Disabled</sl-radio-button>\n    <sl-radio-button value="Slow">Slow</sl-radio-button>\n    <sl-radio-button value="Normal">Normal</sl-radio-button>\n    <sl-radio-button value="Fast">Fast</sl-radio-button>\n    <sl-radio-button value="Faster">Faster</sl-radio-button>\n    <sl-radio-button value="Fastest">Fastest</sl-radio-button>\n    </sl-radio-group>\n\n    <sl-radio-group class="ABCLOnDiaperChangeSelect" label="Select On Diaper Change" name="on-diaper-change" value="${mn.settings.OnDiaperChange}">\n    <sl-radio-button value="Deny">Deny</sl-radio-button>\n    <sl-radio-button value="Ask">Ask</sl-radio-button>\n    <sl-radio-button value="Allow">Allow</sl-radio-button>\n    </sl-radio-group>\n\n  </sl-tab-panel>\n\n  <sl-tab-panel name="remote">\n    In development\n      </sl-tab-panel>\n    </sl-tab-group>\n  </sl-tab-panel>\n</sl-tab-group>\n  `;const e=Un.querySelector(".ABCLPeeMetabolismSelect"),t=Un.querySelector(".ABCLPoopMetabolismSelect"),n=Un.querySelector(".ABCLOnDiaperChangeSelect");if(!e||!t||!n)throw new Error("Could not find elements");e.addEventListener("sl-change",(e=>{mn.settings.PeeMetabolism=e.target.value})),t.addEventListener("sl-change",(e=>{mn.settings.PoopMetabolism=e.target.value})),n.addEventListener("sl-change",(e=>{mn.settings.OnDiaperChange=e.target.value})),v.appendChild(Un),PreferenceRegisterExtensionSetting({Identifier:"ABCL",ButtonText:`${a} Settings`,Image:"https://zoe-64.github.io/ABCL/beta/assets/abcl.png",run:()=>{DrawButton(1815,75,90,90,"","White","Icons/Exit.png")},click:()=>{MouseIn(1815,75,90,90)&&PreferenceSubscreenExtensionsExit()},exit:()=>(Un.classList.add("ABCLHidden"),rn(),!0),load:()=>{Un.classList.remove("ABCLHidden"),e.setAttribute("value",mn.settings.PeeMetabolism),t.setAttribute("value",mn.settings.PoopMetabolism),n.setAttribute("value",mn.settings.OnDiaperChange)}})})(),sn.hookFunction("DialogMenuMapping.activities.GetClickStatus",1,((e,t)=>{const[n,o,r]=e;return o?t(e):null})),sn.hookFunction("DialogChangeMode",1,(async(e,t)=>{const[n]=e;if(t(e),"activities"!==n)return;const o=CurrentCharacter?.FocusGroup?CurrentCharacter:Player,r=await cn("#dialog-activity-grid"),s=o.FocusGroup?.Name;if(s)for(const{activity:e}of Rn){if(!e)continue;const t=new $n(e.ID,e.Name,e.Image,e.OnClick,e.Target,e.TargetSelf,e.Criteria);t.fitsCriteria(o,s)&&($n.isInserted(e.ID)||r.appendChild(t.createButton()))}})),CommandCombine(jn),e=[],sn.hookFunction("TextLoad",5,((t,n)=>{if(!e.some((e=>e.module===CurrentModule&&e.id===CurrentScreen)))return n(t)})),e.forEach((e=>{window[`${e.id}Background`]="Sheet";const{KeyUp:t,Click:n,...o}=e.functions,r={...o,KeyUp:n=>{"Escape"===n.key&&window[`${e.id}Exit`](),t?.(n)},Click:t=>{MouseIn(1815,75,90,90)&&window[`${e.id}Exit`](),n?.(t)}};window[`${e.id}ScreenFunctions`]=r,Object.entries(r).forEach((([t,n])=>{window[`${e.id}${t}`]=n}))})),Wn(),qn(new Jn),qn(new Zn),A(),window.ABCL={inModSubscreen:()=>Boolean(v.querySelector(".ABCLSettingPage")?.classList.contains("ABCLHidden")),isABCLPlayer:c,sendDataToAction:Vn,sendUpdateMyData:Gn,sendRequestOtherDataPacket:Hn},setInterval(eo,6e4),o.info("Ready.")};null==CurrentScreen||"Login"===CurrentScreen?sn.hookFunction("LoginResponse",an.OBSERVE,((e,t)=>{t(e);const n=e[0];if("InvalidNamePassword"===n)return;const{Name:o,AccountName:r}=n;"string"==typeof o&&"string"==typeof r&&Qn()})):Qn();const eo=()=>{"ChatRoom"===CurrentScreen&&mn.update()}}();
//# sourceMappingURL=abcl.js.map
